<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setup TPA on OpenShift :: Red Hat Advanced Developer Suite - Level 3 Self-paced training</title>
    <link rel="canonical" href="https://redhat-ads-tech.github.io/rhads-enablement-l3/modules/setup-tpa/setup-openshift.html">
    <link rel="prev" href="setup.html">
    <link rel="next" href="setup-rhel.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank" style="margin-left: 5%;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739" style="width: 278px;"><g fill="#fff"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#fff"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#fff" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg>
      </a>
      <a class="navbar-item site-title" target="__blank" style="color: #fff !important;" href="https://redhat-ads-tech.github.io/rhads-enablement-l3">Red Hat Advanced Developer Suite - Level 3 Self-paced training</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item navbar-item-right-dropdown has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Links</a>
          <div class="navbar-dropdown navbar-dropdown-right">
            <a class="navbar-item navbar-item-right-content" href="https://redhat.com" target="_blank">Red Hat</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Module 1: Getting started with RHADS</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/foundations.html">Module 2: Setup Red Hat Developer Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/foundations.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_core_features">Core Features</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_software_catalog_and_entities">Software Catalog &amp; Entities</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_plugins">Plugins</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_understanding_the_red_hat_developer_hub_configuration">Red Hat Developer Hub Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/setup-rhdh.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/setup-rhdh.html">Installation &amp; Base Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/configure-your-first-plugin.html">Configure your First Plugin (Authentication)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/plugin-cache.html">Plugin Caching</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/connect-gitlab-scm.html">GitLab Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/connect-argocd.html">Argo CD Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/security.html">Enable Role-Based Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="setup.html">Module 3: Setup Trusted Profile Analyzer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup.html">Overview</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="setup-openshift.html">Setup Trusted Profile Analyzer on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setup-rhel.html">Setup Trusted Profile Analyzer on RHEL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-tas/setup.html">Module 4: Setup Trusted Artifact Signer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup-openshift.html">Setup Trusted Artifact Signer on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup-rhel.html">Setup Trusted Artifact Signer on RHEL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../customize-rhdh.html">Module 5: Customize Red Hat Developer Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customize-rhdh.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../customize-rhdh.html#_lab">Hands-on Lab</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhdh-orchestrator/overview.html">Module 6: Orchestrator for Red Hat Developer Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-orchestrator/overview.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhdh-orchestrator/install.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/install.html">Install &amp; Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/workflows.html">Managing and Running Workflows</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/advanced-workflow.html">Workflows with State and Integrations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../security-practices.html">Module 7: Getting started with security best practices</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tssc-tpa.html">Module 8: Trusted Software Supply Chain with TPA</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tssc-tas.html">Module 9: Attestations, Tekton Chains &amp; Enterprise Contract with TAS</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/tssc-rhdh.html">Module 10: RHADS End-to-End: Production-Ready Development Lifecycle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/introduction.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../production-rhdh/introduction.html">An overview of the composite product set (RHADS)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/lab.html">Hands on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../production-rhdh/lab.html">Full lifecycle of product usage</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tssc-3rdparty-ci.html">Module 11: Trusted Software Supply Chain with other CIs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html">Module 12: Patterns for third-party tools integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#architecting-software-templates">Architecting Software Templates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#patterns">Patterns for third-party tools integrations using software templates for self-service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/lab-intro-self-service-patterns.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-intro-self-service-patterns.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-vm-self-service-patterns.html">Hands-on Lab: VM as a Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-namespace-self-service-patterns.html">Hands-on Lab: Namespace as a Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-db-self-service-patterns.html">Hands-on Lab: DB as a Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ai-intro.html">Module 13: Intro to AI for AI Engineers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai.html">Module 14: RHADS for AI Engineers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#rhai">RH AI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#rhads-ai">How RHADS enables tools AI for AI Engineers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#other-devtools">Other Developer tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-overview-rhads-ai.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-overview-rhads-ai.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-rhads-ai-pe.html">Hands-on Lab: AI Platform Engineering: Using pre-existing software templates to provide the tools to build an AI Agent with Red Hat Advanced Developer Suite</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-rhads-ai-dev.html">Hands-on Lab: AI Engineering: Using Pre-existent software templates to build an AI Agent with Red Hat Advanced Developer Suite</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-intro-rhads-ai.html">Hands-on Lab on other developer tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-intro-rhads-ai.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-ai-devspaces-rhads-ai.html">Hands-on Lab: Build an Agent with RHDH from OpenShift Dev Spaces</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-ai-podman-rhads-ai.html">Hands-on Lab: Experiment with an AI application locally using Podman AI Lab</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../end-to-end.html">Module 15: RHADS Complete: Summary and Next Steps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Dev Mode</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../attrs-page.html">Attributes Page</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</a></li>
    <li><a href="setup.html">Module 3: Setup Trusted Profile Analyzer</a></li>
    <li><a href="setup-openshift.html">Setup Trusted Profile Analyzer on OpenShift</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Setup TPA on OpenShift</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide covers the installation and configuration of Trusted Profile Analyzer (TPA) on OpenShift Container Platform. TPA on OpenShift leverages container orchestration for scalable and efficient security analysis workflows.</p>
</div>
<div class="paragraph">
<p>To install TPA on OpenShift, we have two options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Operator-based install</p>
</li>
<li>
<p>The <code>helm</code> install, using the official helm chart from the <a href="https://charts.openshift.io/"><code>openshift-helm-charts</code> repository</a></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We will go through both installation paths, but there are some prerequisites that we need to look at first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistent Storage for the ingested data (SBOMs, CVEs, Advisories), either as S3 or as PVC</p>
</li>
<li>
<p>A <code>postgresql</code> database for the graph database</p>
</li>
<li>
<p>OIDC setup for authentication, both for the frontend and the REST API (typically used from your CI)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For ease of use, we have prepared some k8s artifacts and helper scripts that you can use. Please open the {openshift_console_url}/terminal[terminal^,window="terminal"], logging in as <code>{openshift_admin_user} / {openshift_admin_password}</code>.</p>
</div>
<div class="paragraph">
<p>Then, clone the following repository:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It&#8217;s a linux terminal, so use <code>&lt;ctrl&gt;&lt;shift&gt;&lt;v&gt;</code> for pasting 🐧
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git clone https://github.com/redhat-tssc-tmm/l3-enablement-helpers.git
cd l3-enablement-helpers</code></pre>
</div>
</div>
<div class="paragraph">
<p>While we&#8217;re here let&#8217;s quickly create two projects to install TPA, one for the operator-based install, one for the <code>helm</code>-based install.</p>
</div>
<div class="paragraph">
<p>The instructions will use that namespace, but you&#8217;re free to choose any name / namespace you want. Just make sure to change it appropriately in the instructions that follow.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project student-tpa-helm
oc new-project student-tpa-operator</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_storage"><a class="anchor" href="#_storage"></a>Storage</h3>
<div class="paragraph">
<p>For (object-)storage, the recommended and supported option is to use S3, provided either by ODF (OpenShift Data Foundations) or Amazon S3.</p>
</div>
<div class="paragraph">
<p>However, for PoC purposes and tests without S3 available, <code>filesystem</code> is also a configuration option that is recognized by the <code>helm</code> Chart and the <code>helm</code>-based Operator. This effectively triggers the helm chart to spin up a PVC.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you choose <code>filesystem</code>, be aware that there are two pods accessing the same PVC - namely the <code>importer</code> and the <code>server</code> pod. The helm chart template creates the PVC as RWO, therefore this only works as long as both pods are on the same node as the PVC.</p>
</div>
<div class="paragraph">
<p>With the help from OpenShift&#8217;s internal PVC/pod affinity rules, this <strong><em>should</em></strong> work in most cases, but it is definitely not recommended for production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">$ oc get pods
NAME                              READY   STATUS    RESTARTS      AGE
importer-666b79c69b-vf2ff         1/1     Running   2 (55m ago)   173m
server-7555686b95-hkq9r           1/1     Running   0             173m
tpa-postgresql-7d4694d455-gtzrg   1/1     Running   1 (57m ago)   3h2m

$ oc get pod importer-666b79c69b-vf2ff -o jsonpath='{range .spec.volumes[?(@.persistentVolumeClaim)]}{.name}{" (PVC: "}{.persistentVolumeClaim.claimName}{")"}{"\n"}{end}{range .spec.containers[*].volumeMounts[?(@.name=="storage")]}{"\tMount: "}{.mountPath}{"\n"}{end}'
storage (PVC: storage)
Mount: /data/storage

$ oc get pod importer-666b79c69b-vf2ff -o jsonpath='{range .spec.volumes[?(@.persistentVolumeClaim)]}{.name}{" (PVC: "}{.persistentVolumeClaim.claimName}{")"}{"\n"}{end}{range .spec.containers[*].volumeMounts[?(@.name=="storage")]}{"\tMount: "}{.mountPath}{"\n"}{end}'
storage (PVC: storage)
Mount: /data/storage</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_s3_storage_using_odf"><a class="anchor" href="#_s3_storage_using_odf"></a><strong>S3 Storage using ODF</strong></h4>
<div class="paragraph">
<p>On the cluster, we have installed ODF, which is part of OPP (OpenShift Platform Plus), so we expect customers to use it for production-grade S3.</p>
</div>
<div class="paragraph">
<p>With ODF installed, all you need to do is create an <code>ObjectBucketClaim</code>. We have prepared that for you in the <code>/prerequisites</code> folder, so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you are in your desired namespace (the generated bucket is namespace-scoped)</p>
</li>
<li>
<p>Go into the directory and create it</p>
</li>
</ol>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/prerequisites/
oc project student-tpa-operator
oc apply -f tpa_objectbucketclaim.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~ $ cd l3-enablement-helpers/prerequisites/
bash-5.1 ~/l3-enablement-helpers/prerequisites $ oc project student-tpa-operator
Already on project "student-tpa-operator" on server "https://172.31.0.1:443".
bash-5.1 ~/l3-enablement-helpers/prerequisites $ ls -al
total 24
drwxr-xr-x. 2 user root  173 Oct 17 16:14 .
drwxr-xr-x. 4 user root   71 Oct 17 16:14 ..
-rw-r--r--. 1 user root  674 Oct 17 16:14 client_tpa-cli.json
-rw-r--r--. 1 user root  776 Oct 17 16:14 client_tpa-frontend.json
-rw-r--r--. 1 user root 2931 Oct 17 16:14 postgresql-openshift.yaml
-rwxr-xr-x. 1 user root  440 Oct 17 16:14 s3.sh
-rw-r--r--. 1 user root  134 Oct 17 16:14 secret-oidc-cli.yaml
-rw-r--r--. 1 user root  181 Oct 17 16:14 tpa_objectbucketclaim.yaml
bash-5.1 ~/l3-enablement-helpers/prerequisites $ oc apply -f tpa_objectbucketclaim.yaml
objectbucketclaim.objectbucket.io/tpa-bucket-claim created
bash-5.1 ~/l3-enablement-helpers/prerequisites $ ./s3.sh
Access Key ID:
uQJELScAXek96XcUUrAl

Secret Access Key:
OFCB8spseTxVPFrUTc3nZecqi+D51IpIpvLBo9gt

Endpoint:
https://s3-openshift-storage.apps.cluster-mdt2d.dynamic.redhatworkshops.io

Bucket Name:
trustify-c443fd04-cc20-4455-ac54-f02921669428

bash-5.1 ~/l3-enablement-helpers/prerequisites $</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As you can see above, we have created a little script (<code>s3.sh</code>) that lists the data from the <code>secret</code> and the <code>configmap</code> that is automatically created for the bucket. We will need that for the values file (both for the operator and the helm chart)
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_database_postgresql"><a class="anchor" href="#_database_postgresql"></a>Database (<code>postgresql</code>)</h3>
<div class="paragraph">
<p>TPA requires a postgresql database for the graph database. We have prepared the a <code>yaml</code> file with the required k8s artifacts, that you can simply apply.
Please take note of the <code>secret</code> (first object in the <code>yaml</code> file) as it contains all the data that we need for the values file (both operator and helm install).</p>
</div>
<div class="paragraph">
<p>Specifically, we need a "regular" database user (<code>tpauser</code>) and an admin user that can create the database (<code>postgres</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~/l3-enablement-helpers/prerequisites $ cat postgresql-openshift.yaml
---
apiVersion: v1
kind: Secret
metadata:
  name: tpa-postgresql-credentials
  labels:
    app: tpa-postgresql
type: Opaque
stringData:
  db.host: "tpa-postgresql"
  db.name: "tpadb"
  db.user: "tpauser"
  db.password: "r3dh8t1!"
  db.admin: "postgres"
  db.adminpassword: "adminr3dh8t1!"
  db.port: "5432"
---</code></pre>
</div>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f postgresql-openshift.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~/l3-enablement-helpers/prerequisites $ oc apply -f postgresql-openshift.yaml
secret/tpa-postgresql-credentials created
persistentvolumeclaim/tpa-postgresql-data created
deployment.apps/tpa-postgresql created
service/tpa-postgresql created
bash-5.1 ~/l3-enablement-helpers/prerequisites $</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oidc_setup"><a class="anchor" href="#_oidc_setup"></a>OIDC setup</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We are using RHBOK (Red Hat build of Keycloak) here, but you can also use Amazon Cognito. Refer to the <a href="https://docs.redhat.com/en/documentation/red_hat_trusted_profile_analyzer/2.1/html/deployment_guide/select-your-installation-platform#installing-trusted-profile-analyzer-by-using-helm-with-aws_deploy">product documentation</a> for that setup if you&#8217;re using Cognito. However, we need to configure OIDC <code>scopes</code> and redirect URLs and we&#8217;ll show you using Keycloak.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-none grid-none stripes-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-realms.png" alt="keycloak realms" width="150"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We already have a working install of TPA that we&#8217;ll use in later exercises - this uses the <code>chicken</code> realm in Keycloak. RHDH, OpenShift and Trusted Artifact Signer use the <code>trusted-artifact-signer</code> realm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">With that said - let&#8217;s use the <code>trusted-artifact-signer</code> realm for our install, so we can use the same user across all applications.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_clients_client_scopes_and_rbac"><a class="anchor" href="#_clients_client_scopes_and_rbac"></a><strong>Clients, Client Scopes and RBAC</strong></h4>
<div class="paragraph">
<p>Using the same realm as other applications, we share the same user base.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users.png" alt="keycloak users"></span></p>
</div>
<div class="paragraph">
<p>Applications might have different requirements for authentication, though. Therefore, it is a good practice to define one or more clients for each application that allows the users of a given realm to authenticate.</p>
</div>
<div class="paragraph">
<p>For the realm we&#8217;re about to use, we have a set of default clients (for typical OIDC and Keycloak use cases) as well as a client for Trusted Artifact Signer, one for Developer Hub and one for OpenShift.</p>
</div>
<div class="paragraph">
<p>We will add our clients here (we&#8217;ll name them <code>tpa-frontend</code> and <code>tpa-cli</code>)</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-clients.png" alt="keycloak clients"></span></p>
</div>
<div class="paragraph">
<p>In addition to <strong>Clients</strong>, TPA uses <strong>Client Scopes</strong> for authorization. In other words, depending on the client scopes associated with a user, it determines what a user can and cannot do.</p>
</div>
<div class="paragraph">
<p>TPA uses the following custom OIDC client scopes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create:document</code></p>
</li>
<li>
<p><code>read:document</code></p>
</li>
<li>
<p><code>update:document</code></p>
</li>
<li>
<p><code>delete:document</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>that we need to create and assign to users or groups of users. We do this by creating roles with a mapping of client scopes and then assign those roles to users or groups.</p>
</div>
<div class="paragraph">
<p>A typical mapping could be</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Client Scopes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read:document</code> (optionally: <code>create:document</code> if you want to allow regular users to upload SBOMs via the UI - or create a <code>power-user</code> role for users that should be allowed to do that)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-manager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read:document</code> <code>create:document</code> <code>update:document</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read:document</code> <code>create:document</code> <code>update:document</code> <code>delete:document</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Adding Client Scopes &amp; Roles</strong></p>
</div>
<div class="paragraph">
<p>We should first add the roles, then the client scopes. After adding the client scopes, we also need to make them available to the clients, and we have client files prepared for you. However, if you import the client files first (which has the client scopes assigned already), these assignments will be ignored, since the scopes are not yet available on the system (they&#8217;re not added automatically).</p>
</div>
<div class="paragraph">
<p>But, let&#8217;s just get started:</p>
</div>
<div class="paragraph">
<p>In your {openshift_console_url}/terminal[terminal^,window="terminal"], go to the <code>prerequisites</code> folder and run the <code>get-keycloak-info.sh</code> script, which will give you the admin login details for the Keycloak Management Console:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/prerequisites/
./get-keycloak-info.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~/l3-enablement-helpers/prerequisites $ ./get-keycloak-info.sh
Keycloak Route: https://sso.apps.cluster-mdt2d.dynamic.redhatworkshops.io
Username: admin
Password: 8bf84c6d862a4205aab02253c0f1b0a1</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Roles</strong></p>
</div>
<div class="paragraph">
<p>Login and (1) select the "Trusted Artifact Signer" realm, then (2) click on "Realm Roles", then (3) "Create role":</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-roles.png" alt="keycloak roles"></span></p>
</div>
<div class="paragraph">
<p>Create the roles <code>tpa-user</code> <code>tpa-manager</code> <code>tpa-admin</code></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-create-roles.png" alt="keycloak create roles"></span></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-created-roles.png" alt="keycloak created roles"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<table class="tableblock frame-none grid-none stripes-none stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-create-roles-associated-roles.png" alt="keycloak create roles associated roles"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>With the "Actions" menu on the right upper hand, you can also define which roles should inherit assignments from other roles (so <code>tpa-manager</code> could inherit the <code>read:document</code> scope from <code>tpa-user</code>, etc - but we want to keep it simple &amp; straightforward here, see below).</p>
</div></div></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Client Scopes</strong></p>
</div>
<div class="paragraph">
<p>In the same (1) "Trusted Artifact Signer" realm, (2) click on "Client Scopes", then (3) "Create client scope":</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-client-scopes.png" alt="keycloak client scopes"></span></p>
</div>
<div class="paragraph">
<p>Create the scopes <code>read:document</code> <code>create:document</code> <code>update:document</code> <code>delete:document</code> and give them a description, if you want.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-create-client-scopes.png" alt="keycloak create client scopes"></span></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure you toggle the "Include in token scope" switch (default is "off", it needs to be "on") - if not, the scope will not be in the login token and you&#8217;ll get a lot of "403" errors when opening TPA.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After saving (or later, opening a Scope from the Client Scopes list), you can assign a role under the "Scope" tab:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-assign-roles.png" alt="keycloak assign roles"></span></p>
</div>
<div class="paragraph">
<p>Assign all roles to the <code>document:reader</code> scope</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-assign-roles-reader.png" alt="keycloak assign roles reader"></span></p>
</div>
<div class="paragraph">
<p>Assign the roles as follows</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Client Scopes</th>
<th class="tableblock halign-left valign-top">Roles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read:document</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-user</code> <code>tpa-manager</code> <code>tpa-admin</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create:document</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-user</code> <code>tpa-manager</code> <code>tpa-admin</code> (we&#8217;re also allowing our regular users to upload SBOMs)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update:document</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-manager</code> <code>tpa-admin</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete:document</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tpa-admin</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Users</strong></p>
</div>
<div class="paragraph">
<p>Now that we have the client scopes and assigned those to specific roles, we need to assign those roles to our users (or, in a production environment, more likely to groups of users).</p>
</div>
<div class="paragraph">
<p>In the same realm (1) go to users (2) and click on <code>user1</code> (3):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users-edit.png" alt="keycloak users edit"></span></p>
</div>
<div class="paragraph">
<p>Click on the "Role Mapping" tab (4) and then "Assign Role" (5) and assign the <code>tpa-users</code> role to "user1":</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users-assign-role.png" alt="keycloak users assign role"></span>
<span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users-assign-role-tpa-user.png" alt="keycloak users assign role tpa user"></span></p>
</div>
<div class="paragraph">
<p>You should see the assigned role now:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users-assigned-role-tpa-user.png" alt="keycloak users assigned role tpa user"></span></p>
</div>
<div class="paragraph">
<p>Now do the same for the <code>admin</code> user and assign the <code>tpa-admin</code> role to that user:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-users-assigned-role-tpa-admin.png" alt="keycloak users assigned role tpa admin"></span></p>
</div>
<div class="paragraph">
<p><strong>Clients</strong></p>
</div>
<div class="paragraph">
<p>Now that we have the client scopes, have assigned these to new roles that we created and assigned those roles to users&#8230;&#8203; we need the clients that provide us with the authentication endpoints for TPA:</p>
</div>
<div class="paragraph">
<p>In the same realm (1), go to Clients (2). Here, you could create the clients manually and configure them ()especially the client scopes that we need associated with this client - but we have created import files for you, so you can instead use "Import Client" (3).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-create-clients.png" alt="keycloak create clients"></span></p>
</div>
<div class="paragraph">
<p>We need a "frontend" client that will handle the authentication with the UI and a "cli" client that we will use as a "technical user", or in Keycloak terminology, as a "Service Account" (not to be mistaken with a k8s ServiceAccount). Basically, it is a user with a set password to be used for service-to-service communication.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>TPA doesn&#8217;t care if we use a "regular" user or a Keycloak "Service Account" for authentication.</p>
</div>
<div class="paragraph">
<p>From a Keycloak / OIDC perspective, separating "Service Accounts" for machine communication from users is a good practice, even though you could have a regular user (e.g. "<a href="mailto:tpa@acme.com">tpa@acme.com</a>") for that use-case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please download the</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/prerequisites/client_tpa-frontend.json" target="_blank" rel="noopener"><code>client_tpa-frontend.json</code></a> (Right-click and "save as")</p>
</li>
<li>
<p><a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/prerequisites/client_tpa-cli.json" target="_blank" rel="noopener"><code>client_tpa-cli.json</code></a> (Right-click and "save as")</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>files to your machine and inspect them, if you like.</p>
</div>
<div class="paragraph">
<p><strong>Frontend</strong></p>
</div>
<div class="paragraph">
<p>First import the <code>client_tpa-frontend.json</code> file - it will populate all the fields and options that we need, then click "save".</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-import-frontend.png" alt="keycloak import frontend"></span>
<span class="image"><img src="../_images/m3-tpa-openshift/keycloak-imported-frontend.png" alt="keycloak imported frontend"></span></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After saving the frontend client, replace the <code>replace.me</code> with the correct workshop cluster ingress domain
<code>{openshift_cluster_ingress_domain}</code>, so you will have</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">https://server-student-tpa-operator.{openshift_cluster_ingress_domain}
https://server-student-tpa-operator.{openshift_cluster_ingress_domain}/*
https://server-student-tpa-helm.{openshift_cluster_ingress_domain}
https://server-student-tpa-helm.{openshift_cluster_ingress_domain}/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>for your redirect URIs - if this is not set correctly, you will get an error when trying to login to the TPA UI.</p>
</div>
<div class="paragraph">
<p><em>If you changed the namespace(s) where you install TPA, please amend accordingly.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CLI ("Service Account")</strong></p>
</div>
<div class="paragraph">
<p>Now, import the CLI client. When you do, you will notice that the "Client Authentication" is switched on (to access this client, the user will have to provide the client secret) and the "service account roles" box is ticked, meaning that this will generate a "technical user" that we can assign roles (remember, we need the roles for the client scopes that tell TPA what the user is allowed to do).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-import-cli.png" alt="keycloak import cli"></span></p>
</div>
<div class="paragraph">
<p>After saving, you can see in the "Credentials" tab, that the client has a client secret assigned.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-import-cli-credentials.png" alt="keycloak import cli credentials"></span></p>
</div>
<div class="paragraph">
<p>Now, go to the "Service Accounts Roles" tab and assign the <code>tpa-admin</code> role to the service account (unless you want to restrict what can be done via the client).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-import-cli-roles.png" alt="keycloak import cli roles"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively, you can also assign that role via the "Users" view, since the client has automatically created that "service-account-&lt;clientname&gt;" user:
<span class="image"><img src="../_images/m3-tpa-openshift/keycloak-import-cli-sa-user.png" alt="keycloak import cli sa user"></span></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last, not least, we need to create a k8s <code>secret</code> for the client secret that is referenced in the <code>helm</code> chart (and the operator-install).</p>
</div>
<div class="paragraph">
<p>If you haven&#8217;t changed the client secret from the imported <code>client_tpa-cli.json</code> file, you can go to the {openshift_console_url}/terminal[terminal^,window="terminal"] and use the <code>secret-oidc-cli.yaml</code> we have prepared for you:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/prerequisites/
oc apply -f secret-oidc-cli.yaml</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~ $ cd ~/l3-enablement-helpers/prerequisites/
oc project student-tpa-operator
oc apply -f secret-oidc-cli.yaml
secret/oidc-cli created</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oidc_summary"><a class="anchor" href="#_oidc_summary"></a>OIDC Summary</h3>
<div class="paragraph">
<p>Phew - you&#8217;ve made it through the OIDC prerequisites. The point here was not to generate a really boring wall of text, but to show what TPA needs to be successfully integrated with an existing Keycloak realm.</p>
</div>
<div class="paragraph">
<p>What we did:</p>
</div>
<div class="paragraph">
<p>In an existing realm, we</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Created (realm) roles</p>
</li>
<li>
<p>Created custom client scopes, that TPA needs for Authorization</p>
</li>
<li>
<p>Assigned these scopes to the roles we created</p>
</li>
<li>
<p>Assigned these roles to users (thus assigned the scopes to users)</p>
</li>
<li>
<p>Created an OIDC "public" frontend client (with the "normal" OIDC authentication flow)</p>
</li>
<li>
<p>Created an OIDC "private" cli client (aka a client with a client secret)</p>
</li>
<li>
<p>Assigned the administrative role to that cli client</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/welldone.gif" alt="welldone"></span></p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s <strong>boldly go to the installation</strong> 🖖</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before we move on - Since TPA only supports Keycloak for authentication/authorization - if there is the need for integration with other providers:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/keycloak-identity-providers.png" alt="keycloak identity providers"></span></p>
</div>
<div class="paragraph">
<p>Keycloak&#8217;s Identity Provider (IdP) federation is designed exactly for this scenario. Here&#8217;s how it works:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>External users authenticate via your configured Identity Provider (e.g., Google, Azure AD, another Keycloak instance, SAML provider)</p>
</li>
<li>
<p>Keycloak creates local user representations for these external identities (either on first login or through synchronization)</p>
</li>
<li>
<p>You map these external identities to your existing roles using Identity Provider Mappers</p>
</li>
<li>
<p>Your existing setup continues to work - once roles are assigned, the custom client scopes you&#8217;ve configured are automatically applied when these users access TPA</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Setting Up Role Mapping</p>
</div>
<div class="paragraph">
<p>In your Keycloak admin console, for each Identity Provider you can configure Mappers to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Map by claim/attribute: Assign roles based on attributes from the external IdP (e.g., "if <code>department=engineering</code>, assign <code>engineer-tpa-role</code> ")</p>
</li>
<li>
<p>Map by IdP username pattern: Assign roles based on username patterns</p>
</li>
<li>
<p>Default roles: Assign specific roles to all users from that IdP</p>
</li>
<li>
<p>Manual assignment: Let external users authenticate, then manually assign them to your groups/roles</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>&#8230;&#8203;but that is beyond the scope of this Lab.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operator_installation"><a class="anchor" href="#_operator_installation"></a>Operator Installation</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The operator is currently in tech preview and has some issues handling multiple installations on the same cluster (it is also using <code>helm</code>). Since we already have installed a TPA for reference using this method, you might see some misleading errors, but the installation itself (and the resulting TPA) works.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that we have configured</p>
</div>
<div class="ulist">
<ul>
<li>
<p>storage</p>
</li>
<li>
<p>database and</p>
</li>
<li>
<p>OIDC</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>let&#8217;s go to the <a href="https://console-openshift-console.{openshift_cluster_ingress_domain}/operatorhub/ns/student-tpa-operator?keyword=trusted+profile&amp;details-item=rhtpa-operator-redhat-operators-openshift-marketplace&amp;channel=stable" target="console">Operator Hub</a> (just follow the link) and install the TPA Operator in our namespace (the Operator is namespace-scoped):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-ohub.png" alt="operator ohub"></span></p>
</div>
<div class="paragraph">
<p>Make sure to install it to the correct namespace (for this exercise, we created <code>student-tpa-operator</code> at the beginning of this chapter).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-ohub-install.png" alt="operator ohub install"></span></p>
</div>
<div class="paragraph">
<p>Once the installation has finished, go the the operator in your namespace and create a <code>TrustedProfileAnalyzer</code> instance.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-ohub-install-create-instance.png" alt="operator ohub install create instance"></span></p>
</div>
<div class="paragraph">
<p>In the instance, switch to the <code>YAML</code> view.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-yaml-view.png" alt="operator tpa yaml view"></span></p>
</div>
<div class="paragraph">
<p>We have prepared a <a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tpa-operator/trustedprofileanalyzer.yaml" target="_blank" rel="noopener"><code>TrustedProfileAnalyzer.yaml</code></a> file for you (right-click and download, or open the link and copy&amp;paste)</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before you replace everything with the provided <code>yaml</code> file make sure to compare the <code>spec.image.fullName</code> with the default that the "empty" operator provides you with.</p>
</div>
<div class="paragraph">
<p>At the time of this writing, the Operator Version 1.0.2 with this image was current:</p>
</div>
<div class="paragraph">
<p><code>fullName: 'registry.redhat.io/rhtpa/rhtpa-trustification-service-rhel9@sha256:d5cf4a5bff94b59197f668a63d29591e3bc92ee89402edc70039e592d75cb84e'</code></p>
</div>
<div class="paragraph">
<p>This will change over time, so please compare (or copy &amp; paste to your local file before you paste it back to the operator <code>yaml</code> view)</p>
</div>
<div class="paragraph">
<p>Also, don&#8217;t paste &amp; save just yet, there are some fields that you need to change - either locally before pasting into the <code>YAML</code> view, or in the <code>YAML</code> view itself!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_whats_inside_and_what_needs_to_be_changed"><a class="anchor" href="#_whats_inside_and_what_needs_to_be_changed"></a><strong>What&#8217;s inside and what needs to be changed</strong></h3>
<div class="paragraph">
<p>In the <code>spec.appDomain</code>, replace <code>&lt;your-cluster-ingressdomain-here&gt;</code> with <code>{openshift_cluster_ingress_domain}</code>:</p>
</div>
<div class="paragraph">
<p><code>appDomain: -student-tpa-operator.&lt;your-cluster-ingressdomain-here&gt;</code></p>
</div>
<div class="paragraph">
<p>Do the same in the <code>spec.oidc.IssuerUrl</code> (this is Keycloak realm where we defined our clients and client scopes):</p>
</div>
<div class="paragraph">
<p><code>issuerUrl: 'https://sso.&lt;your-cluster-ingressdomain-here&gt;/realms/trusted-artifact-signer'</code></p>
</div>
<div class="paragraph">
<p>And, while you still have it in your clipboard, also for the <code>spec.storage.region</code>:</p>
</div>
<div class="paragraph">
<p><code>region: <a href="https://s3-openshift-storage.&lt;your-cluster-ingressdomain-here&gt;:443" class="bare">https://s3-openshift-storage.&lt;your-cluster-ingressdomain-here&gt;:443</a></code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even though it is called <code>region</code> here, for ODF we need to use the OpenShift Storage <code>s3</code> endpoint, including the port <code>:443</code>. For AWS S3, you&#8217;d need the actual region (refer to the <a href="https://docs.redhat.com/en/documentation/red_hat_trusted_profile_analyzer/2.1/html/deployment_guide/select-your-installation-platform#installing-trusted-profile-analyzer-by-using-helm-with-aws_deploy" target="_blank" rel="noopener">product documentation</a> for setup with AWS services).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Since we&#8217;re in the <code>storage</code> section - you can use either <code>s3</code> (as is recommended, and we created a bucket already), or you can comment the existing <code>storage</code> section and uncomment this section</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">#alternatively, uncomment for filesystem / PVC storage
#  storage:
#    type: filesystem
#    size: 32Gi</code></pre>
</div>
</div>
<div class="paragraph">
<p>which will create a PVC.</p>
</div>
<div class="paragraph">
<p>Sticking with <code>s3</code>, we need to get the actual bucket name to be set in the <code>spec.storage.bucket</code> field:</p>
</div>
<div class="paragraph">
<p><code>bucket: trustify-&lt;run_s3.sh_from_your_namespace_to_get_the_bucket_name&gt;</code></p>
</div>
<div class="paragraph">
<p>We can get that from the <code>tpa-bucket-claim</code> ConfigMap in our namespace, or by running the <code>s3.sh</code> script (which will also give us the <code>s3</code> endpoint, which we already changed above).</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/prerequisites
oc project student-tpa-operator
./s3.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~/l3-enablement-helpers/prerequisites $ ./s3.sh
Access Key ID:       uQJELScAXek96XcUUrAl
Secret Access Key:   OFCB8spseTxVPFrUTc3nZecqi+D51IpIpvLBo9gt
Endpoint:            https://s3-openshift-storage.apps.cluster-mdt2d.dynamic.redhatworkshops.io
Bucket Name:         trustify-c443fd04-cc20-4455-ac54-f02921669428</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>What else?</strong></p>
</div>
<div class="paragraph">
<p><strong>Importers</strong></p>
</div>
<div class="paragraph">
<p>The <code>spec.modules.CreateImporters.importers</code> contains the definition and configuration for the various importers. These load (and update) TPA with cve, advisory and SBOM data.</p>
</div>
<div class="paragraph">
<p>By default, only the <code>cve</code> and <code>osv-github</code> importers are active (<code>disabled: false</code>) - without cve and advisory data, TPA couldn&#8217;t match vulnerabilities with SBOM packages.</p>
</div>
<div class="paragraph">
<p><strong>Database</strong></p>
</div>
<div class="paragraph">
<p>The <code>spec.database</code>, <code>spec.createDatabase</code> and <code>spec.migrateDatabase</code> contain the configuration for the <code>postgresql</code> database - since we already created that in the prerequisites section, along with the secret that is referenced here, no changes are required.</p>
</div>
<div class="paragraph">
<p>You will notice that the <code>spec.database.sslMode: require</code> has been commented - for "real" scenarios, this should be enabled, but we decided to keep the database setup simple here (no certificates added to the postgresql setup).</p>
</div>
<div class="paragraph">
<p>Ok, changed the values? Then let&#8217;s hit "Create"!</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/duck-cover-watch.gif" alt="duck cover watch"></span></p>
</div>
<div class="paragraph">
<p>As expected (see the note in the beginning) the Operator install seemingly fails with helm error messages.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-failed.png" alt="operator tpa failed"></span>
<span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-failed-detailed.png" alt="operator tpa failed detailed"></span></p>
</div>
<div class="paragraph">
<p>However, if you go to the <a href="https://console-openshift-console.{openshift_cluster_ingress_domain}/k8s/ns/student-tpa-operator/deployments" target="console">Deployments Page</a>, you can see the importer and server deployments with 1/1 pods.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-failed-deployment.png" alt="operator tpa failed deployment"></span></p>
</div>
<div class="paragraph">
<p>So, let&#8217;s quickly check the pod logs for:</p>
</div>
<div class="paragraph">
<p>1) The <a href="https://console-openshift-console.{openshift_cluster_ingress_domain}/k8s/ns/student-tpa-operator/deployments/importer/pods" target="console">importer pod</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-importer-logs.png" alt="operator tpa importer logs"></span></p>
</div>
<div class="paragraph">
<p>If configured correctly, the importer will start with cloning the cve repository and importing them into the graph database.</p>
</div>
<div class="paragraph">
<p>2) The <a href="https://console-openshift-console.{openshift_cluster_ingress_domain}/k8s/ns/student-tpa-operator/deployments/server/pods" target="console">server pod</a></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-server-logs.png" alt="operator tpa server logs"></span></p>
</div>
<div class="paragraph">
<p>If configured correctly, the server will start but there will not be much activity, aside from the health/readiness probes.</p>
</div>
<div class="paragraph">
<p>Lastly, we should check the <a href="https://console-openshift-console.{openshift_cluster_ingress_domain}/k8s/ns/student-tpa-operator/route.openshift.io~v1~Route" target="console">Route</a> that has been created:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-route.png" alt="operator tpa route"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<table class="tableblock frame-none grid-none stripes-none stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-route-redirect-error.png" alt="operator tpa route redirect error"></span></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If you are seeing this error, check the URL for the parameters <code>client_id=</code> and <code>redirect_uri=</code> and go back to Keycloak and the client definition. Check if the client exists (typo?) and the pattern in the clients redirect URIs matches the one in the <code>redirect_uri=</code> parameter.</p>
</div></div></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_verification"><a class="anchor" href="#_verification"></a>Verification</h3>
<div class="sect3">
<h4 id="_frontend"><a class="anchor" href="#_frontend"></a><strong>Frontend</strong></h4>
<div class="paragraph">
<p>After opening the route URL and logging in with <code>user1</code> or <code>admin</code>, you should see the TPA UI ✅:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-dashboard.png" alt="operator tpa dashboard"></span></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Should you see network-related errors in the TPA UI, this is most likely due to some OIDC misconfiguration. Open the developer perspective of your browser of choice and check if you get <code>403</code> (forbidden) errors.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-dashboard-debug.png" alt="operator tpa dashboard debug"></span></p>
</div>
<div class="paragraph">
<p>Then, copy the <code>Authorization: Bearer</code> token from any erroneous (403) request and run it through a JWT Debugger, such as <a href="https://www.jwt.io/" target="_blank" rel="noopener">jwt.io</a></p>
</div>
<div class="paragraph">
<p>Take note of the "scope" OIDC claim - in this case it contains the <code>create:document read:document</code> scopes that we defined - therefore TPA allows us to view the data (and create/upload SBOMs).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">{
[...]
  "scope": "openid create:document read:document email profile",
  "sid": "0131571b-4f84-44e6-b80a-6ef7bdbae88d",
  "email_verified": true,
  "name": "user1 TSSC",
  "preferred_username": "user1",
  "given_name": "user1",
  "family_name": "TSSC",
  "email": "user1@demo.redhat.com"
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cli"><a class="anchor" href="#_cli"></a><strong>CLI</strong></h4>
<div class="paragraph">
<p>To verify the CLI (REST API) connectivity, go to the {openshift_console_url}/terminal[terminal^,window="terminal"] and inspect the <code>verify-sbom-upload.sh</code> we prepared for you:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/tpa-operator
oc project student-tpa-operator
cat verify-sbom-upload.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The verification is quite straightforward:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We obtain the <code>access token</code> using the <code>client_id</code> and <code>client_secret</code> that we set earlier</p>
</li>
<li>
<p>Using that <code>access token</code>, we post to the <code>/api/v2/sbom</code> endpoint (we have prepared a simple SBOM to test this with).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the same way, you would use that in a CI Task, uploading an SBOM that has just been generated.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s do this:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./verify-sbom-upload.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">bash-5.1 ~/l3-enablement-helpers/tpa-operator $ ./verify-sbom-upload.sh
Access Token:
==================================================================================================
eyJhbG[...]GGHw
==================================================================================================

Uploading homebanking SBOM

{"id":"urn:uuid:0199fdf6-f4ce-7fd1-8d7e-89c8b03cafb8","document_id":"urn:uuid:18ca2b81-e4d2-4c6a-8bb5-54bfb6ae47a3/1"}

bash-5.1 ~/l3-enablement-helpers/tpa-operator $</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see this now in your <a href="https://server-student-tpa-operator.{openshift_cluster_ingress_domain}/sboms" target="TPA">TPA instance</a> after a few moments, including the labels we assigned ✅.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/operator-tpa-sbom.png" alt="operator tpa sbom"></span></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are wondering why there are no vulnerabilities - we have imported the SBOM right after installation, but the importer is still running, importing CVEs and security advisories. So, this will take a while - on a system with fully imported advisory/cve sources, the vulnerabilities will be available momentarily.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_helm_installation"><a class="anchor" href="#_helm_installation"></a>Helm Installation</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to use <code>filesystem</code> (for non-production systems) and you have access to a storage provider / storage class that supports RWX PVCs, you could run the helm install from a local helm repo. You would need to download the official helm chart and install from a local chart:</p>
</div>
<div class="paragraph">
<p><code>helm pull openshift-helm-charts/redhat-trusted-profile-analyzer --untar</code></p>
</div>
<div class="paragraph">
<p>The template file you&#8217;d need to modify (with the RWO PVC) is</p>
</div>
<div class="paragraph">
<p><code>/redhat-trusted-profile-analyzer/templates/services/server/010-PersistentVolumeClaim-storage.yaml</code></p>
</div>
<div class="paragraph">
<p><strong>This is not possible for the operator-based install, since the helm chart being used cannot be modified and the official chart uses RWO.</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the <code>helm</code>-based installation, we will use the <code>student-tpa-helm</code> namespace, and we had created the appropriate <code>redirect_URIs</code> in the frontend OIDC client, which we will reuse.</p>
</div>
<div class="paragraph">
<p>So, first, let&#8217;s get ready to configure the database, s3 bucket and the OIDC secret in this namespace:</p>
</div>
<div class="paragraph">
<p>Go to your {openshift_console_url}/terminal[terminal^,window="terminal"] and run the following commands:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/prerequisites
oc project student-tpa-helm
oc apply -f postgresql-openshift.yaml
oc apply -f tpa_objectbucketclaim.yaml
oc apply -f secret-oidc-cli.yaml
./s3.sh
cd ../tpa-helm/
ls -al</code></pre>
</div>
</div>
<div class="paragraph">
<p>Same as in the operator-based exercise, we have prepared values files for you:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tpa-helm/values.yaml" target="_blank" rel="noopener">values.yaml</a> file for the S3-based installation</p>
</li>
<li>
<p>A <a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tpa-helm/values-fs.yaml" target="_blank" rel="noopener">values-fs.yaml</a> file, if you want to try with the filesystem (for quick testing and PoC/non-production)</p>
</li>
<li>
<p>A <a href="https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tpa-helm/values-importers.yaml" target="_blank" rel="noopener">values-importers.yaml</a> file, with the default settings (osv-github and cve enabled, the others disabled). There is no need to modify any value here, unless you want to.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Since we&#8217;re running <code>helm</code> to install, you don&#8217;t have to download them - but you need to modify them in your terminal session from above:</p>
</div>
<div class="paragraph">
<p>Use your editor of choice (<code>nano</code> or <code>vim</code>) and change the following values (for <code>values.yaml</code> or 'values-fs.yaml'):</p>
</div>
<div class="paragraph">
<p>In the <code>storage.region</code> field, replace <code>&lt;your-cluster-ingressdomain-here&gt;</code> with <code>{openshift_cluster_ingress_domain}</code>:</p>
</div>
<div class="paragraph">
<p><code>region: <a href="https://s3-openshift-storage.&lt;your-cluster-ingressdomain-here&gt;:443" class="bare">https://s3-openshift-storage.&lt;your-cluster-ingressdomain-here&gt;:443</a></code></p>
</div>
<div class="paragraph">
<p>In <code>storage.bucket</code>, paste the value for the <code>trustify</code> bucket that we just got as output from the <code>s3.sh</code> script.</p>
</div>
<div class="paragraph">
<p><code>bucket: trustify-&lt;run_s3.sh_from_your_namespace_to_get_the_bucket_name&gt;</code></p>
</div>
<div class="paragraph">
<p>In the <code>oidc.issuerUrl</code> field, also replace the cluster ingress domain:</p>
</div>
<div class="paragraph">
<p><code>issuerUrl: <a href="https://sso.&lt;your-cluster-ingressdomain-here&gt;/realms/trusted-artifact-signer" class="bare">https://sso.&lt;your-cluster-ingressdomain-here&gt;/realms/trusted-artifact-signer</a></code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you decide to try out the <code>filesystem</code> storage, obviously you don&#8217;t have to change any value there - these are left in the <code>values-fs.yaml</code> file for reference, but commented out. You still need to change the <code>oidc.issuerUrl</code> field, but that&#8217;s all.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ok, ready to go?</p>
</div>
<div class="paragraph">
<p>Let&#8217;s helm!</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">source appdomain.sh
helm repo add openshift-helm-charts https://charts.openshift.io/
helm repo update
helm upgrade --install redhat-trusted-profile-analyzer openshift-helm-charts/redhat-trusted-profile-analyzer -n $NAMESPACE --values values.yaml --values values-importers.yaml --set-string appDomain=$APP_DOMAIN_URL</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">source appdomain.sh
helm repo add openshift-helm-charts https://charts.openshift.io/
helm repo update
helm upgrade --install redhat-trusted-profile-analyzer openshift-helm-charts/redhat-trusted-profile-analyzer -n $NAMESPACE --values values.yaml --values values-importers.yaml --set-string appDomain=$APP_DOMAIN_URL
NAMESPACE is: student-tpa-helm
APP_DOMAIN_URL (needed in helm values) set to:
-student-tpa-helm.apps.cluster-mdt2d.dynamic.redhatworkshops.io
"openshift-helm-charts" already exists with the same configuration, skipping
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "backstage" chart repository
...Successfully got an update from the "rhtap" chart repository
...Successfully got an update from the "openshift-helm-charts" chart repository
...Successfully got an update from the "bitnami" chart repository
Update Complete. ⎈Happy Helming!⎈
Release "redhat-trusted-profile-analyzer" does not exist. Installing it now.
NAME: redhat-trusted-profile-analyzer
LAST DEPLOYED: Mon Oct 20 14:38:19 2025
NAMESPACE: student-tpa-helm
STATUS: deployed
REVISION: 1
NOTES:
OpenShift:
  Detected:       true
  Use Service CA: true

Console:
    server-student-tpa-helm.apps.cluster-mdt2d.dynamic.redhatworkshops.io</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_verification_2"><a class="anchor" href="#_verification_2"></a>Verification</h3>
<div class="sect3">
<h4 id="_frontend_2"><a class="anchor" href="#_frontend_2"></a><strong>Frontend</strong></h4>
<div class="paragraph">
<p>So, you can open your <code>helm</code>-based install of TPA now from <a href="https://server-student-tpa-helm.{openshift_cluster_ingress_domain}" target="TPA">here</a>, and after logging in with <code>user1</code> or <code>admin</code>, you should see the TPA UI based off of the <code>student-tpa-helm</code> namespace ✅:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/helm-tpa-dashboard.png" alt="helm tpa dashboard"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_cli_2"><a class="anchor" href="#_cli_2"></a><strong>CLI</strong></h4>
<div class="paragraph">
<p>We have prepared the verification script in the <code>tpa-helm</code> directory as well:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ~/l3-enablement-helpers/tpa-helm
oc project student-tpa-helm
./verify-sbom-upload.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, we should see the uploaded SBOM now in the <a href="https://server-student-tpa-helm.{openshift_cluster_ingress_domain}/sboms" target="TPA">TPA SBOM View</a> after a few moments, including the labels we assigned ✅.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../_images/m3-tpa-openshift/helm-tpa-sbom.png" alt="helm tpa sbom"></span></p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="setup.html" class="query-params-link">Module 3: Setup Trusted Profile Analyzer</a></span>
  <span class="next"><a href="setup-rhel.html" class="query-params-link">Setup Trusted Profile Analyzer on RHEL</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
