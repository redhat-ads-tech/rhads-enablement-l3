<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cluster Image Policies (CIP) :: Red Hat Advanced Developer Suite - Level 3 Self-paced training</title>
    <link rel="canonical" href="https://redhat-ads-tech.github.io/rhads-enablement-l3/modules/tssc-tas/ex3.4-sigstore-cip.html">
    <link rel="prev" href="ex3.3-sigstore-config.html">
    <link rel="next" href="ex4-acs-controller.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://demo.redhat.com" target="_blank" style="margin-left: 5%;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739" style="width: 278px;"><g fill="#fff"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#fff"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#fff" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg>
      </a>
      <a class="navbar-item site-title" target="__blank" style="color: #fff !important;" href="https://redhat-ads-tech.github.io/rhads-enablement-l3">Red Hat Advanced Developer Suite - Level 3 Self-paced training</a>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item navbar-item-right-dropdown has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Links</a>
          <div class="navbar-dropdown navbar-dropdown-right">
            <a class="navbar-item navbar-item-right-content" href="https://redhat.com" target="_blank">Red Hat</a>
            <a class="navbar-item navbar-item-right-content" href="env.html" target="_blank">Lab</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="modules" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html" class=" query-params-link">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../getting-started.html">Module 1: Getting started with RHADS</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/foundations.html">Module 2: Setup Red Hat Developer Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/foundations.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_core_features">Core Features</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_software_catalog_and_entities">Software Catalog &amp; Entities</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_plugins">Plugins</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/foundations.html#_understanding_the_red_hat_developer_hub_configuration">Red Hat Developer Hub Configuration</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-rhdh/setup-rhdh.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/setup-rhdh.html">Installation &amp; Base Configuration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/configure-your-first-plugin.html">Configure your First Plugin (Authentication)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/plugin-cache.html">Plugin Caching</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/connect-gitlab-scm.html">GitLab Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/connect-argocd.html">Argo CD Integration</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../setup-rhdh/security.html">Enable Role-Based Access Control</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-tpa/setup.html">Module 3: Setup Trusted Profile Analyzer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tpa/setup.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tpa/setup-openshift.html">Setup Trusted Profile Analyzer on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tpa/setup-rhel.html">Setup Trusted Profile Analyzer on RHEL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../setup-tas/setup.html">Module 4: Setup Trusted Artifact Signer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup-openshift.html">Setup Trusted Artifact Signer on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../setup-tas/setup-rhel.html">Setup Trusted Artifact Signer on RHEL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhdh-ui/foundations.html">Module 5: Red Hat Developer Hub User Interface</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-ui/foundations.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-ui/customize-rhdh.html">Hands-on Lab: Customize RHDH Appearance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-ui/techdocs-foundations.html">TechDocs Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-ui/techdocs-lab-user.html">TechDocs Lab 1: Creating and Editing TechDocs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhdh-orchestrator/overview.html">Module 6: Orchestrator for Red Hat Developer Hub</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rhdh-orchestrator/overview.html">Foundations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhdh-orchestrator/install.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/install.html">Install &amp; Setup</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/workflows.html">Managing and Running Workflows</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhdh-orchestrator/advanced-workflow.html">Workflows with State and Integrations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security-practices/overview.html">Module 7: Getting started with security best practices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-practices/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-practices/security-practices.html">Foundations and Frameworks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../security-practices/understanding-keyless.html">Understanding Keyless Signing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../security-practices/exercises.html">Exercises</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security-practices/ex1-signing-images.html">Image Signing &amp; Verification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security-practices/ex2-git-signing.html">Commit Signing &amp; Verification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security-practices/ex3-provenance.html">Provenance &amp; Attestations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security-practices/ex4-sboms.html">SBOM Creation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tssc-tpa/tssc-tpa.html">Module 8: Trusted Software Supply Chain with TPA</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tssc-tpa/correlation.html">Data Types &amp; Correlation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tssc-tpa/exercises.html">Exercises</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tssc-tpa/ex1-uploading-sboms.html">Exercise: Uploading Data</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tssc-tpa/ex2-ui-usecases.html">Exercise: Exploring the Security Posture</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tssc-tpa/ex3-licenses.html">Exercise: (Open Source) License Compliance</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="tssc-tas.html">Module 9: Attestations, Tekton Chains &amp; Enterprise Contract with TAS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="exercises.html">Exercises</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ex1-chains.html">Tekton Chains</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ex2-enterprise-contract.html">Conforma and Rego policies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ex3-sigstore-controller.html">Sigstore Admission Controller</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ex3.1-sigstore-prep.html">Preparation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ex3.2-sigstore-install.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ex3.3-sigstore-config.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="4">
    <a class="nav-link" href="ex3.4-sigstore-cip.html">ClusterImagePolicies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ex4-acs-controller.html">RHACS Admission Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ex-controller-summary.html">Admission Controllers Summary</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/tssc-rhdh.html">Module 10: RHADS End-to-End: Production-Ready Development Lifecycle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/introduction.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../production-rhdh/introduction.html">An overview of the composite product set (RHADS)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production-rhdh/lab.html">Hands on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../production-rhdh/lab.html">Full lifecycle of product usage</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tssc-3rdparty-ci.html">Module 11: Trusted Software Supply Chain with other CIs</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html">Module 12: Patterns for third-party tools integrations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#architecting-software-templates">Architecting Software Templates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/self-service-patterns.html#patterns">Patterns for third-party tools integrations using software templates for self-service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../self-service-patterns/lab-intro-self-service-patterns.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-intro-self-service-patterns.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-vm-self-service-patterns.html">Hands-on Lab: VM as a Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-namespace-self-service-patterns.html">Hands-on Lab: Namespace as a Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../self-service-patterns/lab-db-self-service-patterns.html">Hands-on Lab: DB as a Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ai-intro.html">Module 13: Intro to AI for AI Engineers</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai.html">Module 14: RHADS for AI Engineers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai.html">Foundations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#introduction">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#rhai">RH AI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#rhads-ai">How RHADS enables tools AI for AI Engineers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai.html#other-devtools">Other Developer tools</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-overview-rhads-ai.html">Hands-on Lab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-overview-rhads-ai.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-rhads-ai-dev-setup.html">Hands-on Lab: AI Engineering: Streamline AI Agent Development with Red Hat Advanced Developer Suite Templates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-rhads/lab-ai-rhads-rhads-ai-dev.html">Hands-on Lab: AI Engineering: Implementing AI Agent Development with Red Hat Advanced Developer Suite</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-intro-rhads-ai.html">Hands-on Lab on other developer tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-intro-rhads-ai.html#introduction">Hands-on Lab Overview</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-ai-devspaces-rhads-ai.html">Hands-on Lab: Build an Agent with RHDH from OpenShift Dev Spaces</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rhads-ai/rhads-ai-devtools/lab-ai-podman-rhads-ai.html">Hands-on Lab: Experiment with an AI application locally using Podman AI Lab</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../end-to-end.html">Module 15: RHADS Complete: Summary and Next Steps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../env.html">My lab environment details</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Red Hat Advanced Developer Suite (RHADS) - Technical Workshop</a></li>
    <li><a href="tssc-tas.html">Module 9: Attestations, Tekton Chains &amp; Enterprise Contract with TAS</a></li>
    <li><a href="exercises.html">Exercises</a></li>
    <li><a href="ex3-sigstore-controller.html">Sigstore Admission Controller</a></li>
    <li><a href="ex3.4-sigstore-cip.html">ClusterImagePolicies</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Cluster Image Policies (CIP)</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>First, we need a new namespace that we want the controller to watch and label it appropriately:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc new-project student-admission-test
oc label namespace student-admission-test policy.rhtas.com/include=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we create a <code>ClusterImagePolicy</code> (CIP) let&#8217;s take a look at some important components and principles.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cip_structure"><a class="anchor" href="#_cip_structure"></a>CIP Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Among a lot of other configuration options, the most important ones are the <code>spec.images.glob[]</code> (an image pattern) and the <code>spec.authorities</code> (used to validate signatures and attestations).</p>
</div>
<div class="sect2">
<h3 id="_image_patterns"><a class="anchor" href="#_image_patterns"></a>Image Patterns</h3>
<div class="paragraph">
<p>The <code>ClusterImagePolicy</code> specifies <code>spec.images</code> which specifies a list of <code>glob</code> matching patterns. These matching patterns will be matched against the image digest of <code>PodSpec</code> resources attempting to be deployed.<br></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The resource type that the policy matches the image against (default: <code>PodSpec</code>) can be changed, but with the default setting it will make sure that all higher-level k8s resources that make use of "PodSpec" (such as Deployments) will return an error if the policy denies an image.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Glob uses golang <a href="https://pkg.go.dev/path/filepath#Match" target="docs">filepath</a> semantics for matching the images against. Additionally you can specify a more traditional <code>**</code> to match any number of characters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: image-policy
spec:
  images:
  - glob: "**" <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>will match any image from any repository in any registry</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_authorities"><a class="anchor" href="#_authorities"></a>Authorities</h3>
<div class="paragraph">
<p>When a policy is selected to be evaluated against the matched image (the namespace is being watched and the image matches the <code>glob</code>), the authorities will be used to validate signatures and attestations. If at least one authority is satisfied and a signature or attestation is validated, the policy is validated.</p>
</div>
<div class="paragraph">
<p>Authorities are combined as a boolean "or" (at least one is satisfied within a CIP).</p>
</div>
<div class="paragraph">
<p>There are different types auf Authorities that can be used for validation of images and attestations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>key</code> validates against a static key provided</p>
<div class="ulist">
<ul>
<li>
<p>inline</p>
</li>
<li>
<p>in a k8s secret *in the namespace where the <code>policy-controller</code> is installed</p>
</li>
<li>
<p>in a KMS (Azure, AWS, GCP, HashiCorp Vault)</p>
</li>
</ul>
</div>
</li>
<li>
<p>'keyless' validates against a <code>sigstore</code> (Trusted Artifact Signer) installation</p>
</li>
<li>
<p><code>static</code> doesn&#8217;t validate anything, but instead is statically either <code>pass</code> or <code>fail</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_admission_of_images"><a class="anchor" href="#_admission_of_images"></a>Admission of Images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How does it work together when you define multiple policies with multiple authorities?</p>
</div>
<div class="paragraph">
<p>An image is admitted after it has been validated against all <code>ClusterImagePolicy</code> that matched the image (<code>glob</code>) and that there was at least one passing <code>authority</code> in each of the matched <code>ClusterImagePolicy</code>.<br>
<strong>So each <code>ClusterImagePolicy</code> that matches is <em>AND</em> for admission, and within each <code>ClusterImagePolicy</code> <code>authorities</code> are <em>OR</em>.</strong></p>
</div>
<div class="paragraph">
<p>Having three policies defined, an example of an allowed admission would be</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the image matched against <code>policy1</code> and <code>policy3</code><br></p>
</li>
<li>
<p>A valid signature or attestation was obtained for <code>policy1</code> with at least one of the <code>policy1</code> authorities<br></p>
</li>
<li>
<p>A valid signature or attestation was obtained for <code>policy3</code> with at least one of the <code>policy3</code> authorities<br></p>
</li>
<li>
<p>The image is admitted</p>
</li>
</ol>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>An example of a denied admission would be:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the image matched against <code>policy1</code> and <code>policy2</code><br></p>
</li>
<li>
<p>A valid signature or attestation was obtained for <code>policy1</code> with at least one of the <code>policy1</code> authorities<br></p>
</li>
<li>
<p>No valid signature or attestation was obtained for <code>policy2</code> with at least one of the <code>policy2</code> authorities<br></p>
</li>
<li>
<p>The image is <strong>not</strong> admitted</p>
</li>
</ol>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><strong>By default, any image that does not match a policy is rejected!</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_simple_cip"><a class="anchor" href="#_a_simple_cip"></a>A simple CIP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To try the PolicyController with the images we created, we&#8217;ll create a simple CIP:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>matching all images (<code>glob: "**"</code>)</p>
</li>
<li>
<p>a single <code>keyless</code> authority, pointing to our RHTAS instance</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: cluster-image-policy
spec:
  images:
    - glob: "**" <i class="conum" data-value="1"></i><b>(1)</b>
  authorities:
    - keyless:
        url: $FULCIO_URL <i class="conum" data-value="2"></i><b>(2)</b>
        trustRootRef: $TRUST_ROOT_RESOURCE <i class="conum" data-value="3"></i><b>(3)</b>
        identities:
          - issuer: $OIDC_ISSUER_URL <i class="conum" data-value="4"></i><b>(4)</b>
            subject: $OIDC_SUBJECT <i class="conum" data-value="5"></i><b>(5)</b>
      ctlog:
        url: $REKOR_URL <i class="conum" data-value="6"></i><b>(6)</b>
        trustRootRef: $TRUST_ROOT_RESOURCE <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This policy will match all images, from anywhere</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>keyless</code> authority will check for signature certificates issued by this <code>fulcio</code> endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>TrustRoot</code> CR we defined earlier</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The verified OIDC identity needs to have come from this OIDC system</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>subject</code> is the OIDC identity, in our case <code>pipeline-auth@demo.redhat.com</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If we don&#8217;t provide a Transparency Log (rekor) endpoint, it will fall back to the public good instance of rekor.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_create_the_cip"><a class="anchor" href="#_create_the_cip"></a>Create the CIP</h3>
<div class="paragraph">
<p>We need to create the the ClusterImagePolicy in the <code>policy-controller-operator</code> namespace, and we&#8217;ll use the variables pointing to our pre-installed RHTAS again (since we keylessly signed one of the images with this RHTAS).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember, our "Podman Terminal" comes with these preconfigured, simply type <code>help</code> in the terminal to see the full list.
</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo "OIDC_ISSUER_URL:     ${OIDC_ISSUER_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuer: $OIDC_ISSUER_URL
            subject: pipeline-auth@demo.redhat.com
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_cip"><a class="anchor" href="#_testing_the_cip"></a>Testing the CIP</h3>
<div class="paragraph">
<p>We had labelled our <code>student-admission-test</code> namespace with <code>policy.rhtas.com/include=true</code>, so we&#8217;ll deploy into that one to verify if our policy is working.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc get project student-admission-test -o jsonpath='{.metadata.labels}' | jq
{
  "kubernetes.io/metadata.name": "student-admission-test",
  "openshift-pipelines.tekton.dev/namespace-reconcile-version": "1.19.3",
  "pod-security.kubernetes.io/audit": "baseline",
  "pod-security.kubernetes.io/audit-version": "latest",
  "pod-security.kubernetes.io/warn": "baseline",
  "pod-security.kubernetes.io/warn-version": "latest",
  "policy.rhtas.com/include": "true"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we created the images to test with, we stored an environment variable <code>$IMAGE</code> that contains the image and tag - we&#8217;ll use that for some testing. In each of the directories, we have a <code>deploy.yaml</code>, that contains a <code>deployment</code>, a <code>service</code> and a <code>route</code> for our simple test image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: unsigned-image
  labels:
    app: unsigned-image
spec:
  replicas: 1
  selector:
    matchLabels:
      app: unsigned-image
  template:
    metadata:
      labels:
        app: unsigned-image
    spec:
      containers:
      - name: unsigned-image
        image: $IMAGE
        ports:
        - containerPort: 8080
          protocol: TCP</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, we&#8217;ll use that and see what happens:</p>
</div>
</div>
<div class="sect2">
<h3 id="_unsigned_image"><a class="anchor" href="#_unsigned_image"></a>Unsigned Image</h3>
<div class="paragraph">
<p>The one policy we have deployed matches all images and has one authority, checking for a keylessly signed image.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/unsigned-image
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned:2025-11-17_14-41
service/unsigned-image created
route.route.openshift.io/unsigned-image created
Error from server (BadRequest): error when creating "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned:2025-11-17_14-41@sha256:c3804ea119c09bdbc9d5e15321b3d63393829523dc9061f05ee0d6906fb2806d signature keyless validation failed for authority authority-0 for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned@sha256:c3804ea119c09bdbc9d5e15321b3d63393829523dc9061f05ee0d6906fb2806d: no signatures found</code></pre>
</div>
</div>
<div class="paragraph">
<p>And this is what we&#8217;d expect - <code>no signatures found</code> âœ…</p>
</div>
<div class="paragraph">
<p>In other words - no unsigned image will make it to this namespace!</p>
</div>
</div>
<div class="sect2">
<h3 id="_signed_with_a_key"><a class="anchor" href="#_signed_with_a_key"></a>Signed with a key</h3>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
service/signed-image-key created
route.route.openshift.io/signed-image-key created
Error from server (BadRequest): error when creating "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824 signature keyless validation failed for authority authority-0 for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824: no matching signatures: error verifying bundle: nil certificate provided</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, it worked - it recognises the signature but the authority we created can&#8217;t verify it: <code>no matching signatures</code> âœ…</p>
</div>
</div>
<div class="sect2">
<h3 id="_keylessly_signed_image"><a class="anchor" href="#_keylessly_signed_image"></a>Keylessly Signed Image</h3>
<div class="paragraph">
<p>We signed that keylessly with RHTAS and the <code>subject</code> (aka OIDC Identity) <code>pipeline-auth@demo.redhat.com</code>, which is what our authority expects:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keyless
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-keylessly:2025-11-17_14-44
deployment.apps/signed-image-keyless created
service/signed-image-keyless created
route.route.openshift.io/signed-image-keyless created</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/tssc-tas/ah-yeah.gif" alt="ah yeah">
</div>
</div>
<div class="paragraph">
<p>Aaand, our image is admitted without further ado - it matched the policy&#8217;s <code>glob</code> and its signature could be verified against the authority, which defined the RHTAS endpoints and the <code>subject</code> that the image needed to be verified by.</p>
</div>
<div class="paragraph">
<p>And here&#8217;s <a href="https://signed-image-keyless-student-admission-test.{openshift_cluster_ingress_domain}" target="deployedimage">more proof</a> it made it onto our cluster. ðŸ˜‰</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>During image creation, we have made sure that the repositories on Quay are <strong><em>public</em></strong>.<br>
If you see an error message like this: <code>&lt;image:tag&gt; must be an image digest: &#8230;&#8203;</code></p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Error from server (BadRequest): error when creating "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: invalid value: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned:2025-11-15_20-27 must be an image digest: spec.template.spec.containers[0].image</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the <code>MutatingWebhook</code> can&#8217;t resolve the tag to an image digest - most probably it doesn&#8217;t have access to the repository on your registry.</p>
</div>
<div class="paragraph">
<p>You can solve that by</p>
</div>
<div class="paragraph">
<p>1) using an image digest directly in your deployment resource (which is a good practice for production deployments anyway, as tags might change and you might want to control which exact image you&#8217;re deploying)</p>
</div>
<div class="paragraph">
<p>2) Granting the webhook access to the registry/repository by adding and linking a <code>.dockerconfigjson</code> secret (pull secret) to the Webhook Service Account in the <code>policy-controller-operator</code> namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc get sa -n policy-controller-operator
NAME                                                     SECRETS   AGE
builder                                                  1         23h
default                                                  1         23h
deployer                                                 1         23h
l3-students-policycontroller-policy-controller-webhook   1         23h <i class="conum" data-value="1"></i><b>(1)</b>
pipeline                                                 1         23h</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Webhook SA that resolves tags into digests</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_extending_the_cip"><a class="anchor" href="#_extending_the_cip"></a>Extending the CIP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have built and tested our first <code>ClusterImagePolicy</code>, we&#8217;ll change it a bit.</p>
</div>
<div class="sect2">
<h3 id="_regex_expressions"><a class="anchor" href="#_regex_expressions"></a>RegEx expressions</h3>
<div class="paragraph">
<p>Similar to what we learned about <code>cosign verify</code> and its use of the <code>--certificate-identity-regexp</code> and <code>--certificate-oidc-issuer-regexp</code> options, we can do the same in our <code>keyless</code> <code>authority</code>, using <code>issuerRegExp</code> instead of <code>issuer</code> and <code>subjectRegExp</code> instead of <code>subject</code>, respectively.</p>
</div>
<div class="paragraph">
<p>If we wanted to admit all images signed by a Red Hatter that authenticated against any OIDC system running on the <code>redhatworkshops.io</code> domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  images:
    - glob: "**"
  authorities:
    - keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that in mind, we&#8217;ll update our ClusterImagePolicy:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can deploy our keylessly signed image again:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keyless
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You might be wondering - the deploy.yaml hasn&#8217;t changed, so would it really validate if I deploy the same again?</p>
</div>
<div class="paragraph">
<p>You can see that - even though the deployment hasn&#8217;t changed - it says <code>configured</code>, not <code>unchanged</code>, as we might expect. That&#8217;s because the <code>MutatingWebHook</code> and then the <code>ValidationWebHook</code> are triggered whenever we instantiate any k8s artifact that has a <code>PodSpec</code> in this namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-keylessly:2025-11-17_14-44
deployment.apps/signed-image-keyless configured <i class="conum" data-value="1"></i><b>(1)</b>
service/signed-image-keyless unchanged
route.route.openshift.io/signed-image-keyless unchanged</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The admission webhooks modified (tag to digest conversion) and validated the <code>deployment</code></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you really want to verify that it worked</p>
</div>
<div class="ulist">
<ul>
<li>
<p>redeploy the <code>ClusterImagePolicy</code> but modify the RegEx pattern, so it won&#8217;t match and try again - it will fail.</p>
</li>
<li>
<p>delete the deployment and try again (there is only one, because the other deployments were blocked - not just the pods or containers within them)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc get deployment
NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
signed-image-keyless   1/1     1            1           108m</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_images_signed_with_a_key"><a class="anchor" href="#_images_signed_with_a_key"></a>Images signed with a key</h3>
<div class="paragraph">
<p>We learned earlier, that we can add more than one <code>authority</code> to an <code>ClusterImagePolicy</code> and these are combined with <strong>OR</strong>, meaning an image is admitted if</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it matches the policies <code>glob</code> pattern</p>
</li>
<li>
<p>at least one of the authorities can validate it</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  images:
    - glob: "**"
  authorities:
    - keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
    - key:
        secretRef: <i class="conum" data-value="1"></i><b>(1)</b>
          name: secretName
      ctlog: <i class="conum" data-value="2"></i><b>(2)</b>
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>secretRef</code> specifies the secret location name in the same namespace where policy-controller is installed. The first key value will be used in the secret.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>ctlog</code> is optional here - if omitted, it will just verify the signature against the public key in the secret. If provided, it will also verify that there is a corresponding entry in the transparency log (more secure).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We signed our image with the <code>cosign</code> key that Tekton Chains is also using in its current "key-ful" configuration. Since the requirement for <code>key</code> authorities (if they use a k8s secret) is to have the secret in the <code>policy-controller-operator</code> namespace, we&#8217;ll have to copy it over:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/config
./copy-signing-key.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">oc describe secret chains-cosign-pubkey -n policy-controller-operator
Name:         chains-cosign-pubkey
Namespace:    policy-controller-operator
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;

Type:  Opaque

Data
====
cosign.pub:  177 bytes</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the public key secret in place, we can modify our <code>ClusterImagePolicy</code> to add an <code>authority</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>The admission controller should now also allow images that have been signed by that <code>cosign</code> key:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
deployment.apps/signed-image-key created <i class="conum" data-value="1"></i><b>(1)</b>
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>deployment</code> of the "keyfully" signed image is now admitted. The <code>service</code> and <code>route</code> had been there from our previous try when the <code>deployment</code> was blocked.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_attestations"><a class="anchor" href="#_attestations"></a>Attestations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to Enterprise Contract (Conforma), the Sigstore Admission Controller can also check for the existence of signed attestations associated with that image. Since it checks if the attestation has been signed, it is part of the <code>authority</code> structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation <i class="conum" data-value="1"></i><b>(1)</b>
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
    - name: key-with-attestation-check <i class="conum" data-value="1"></i><b>(1)</b>
      key:
        secretRef:
          name: secretName
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations: <i class="conum" data-value="2"></i><b>(2)</b>
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For more complex CIPs, it&#8217;a good idea to give authorities (and attestation checks) a name, since these will be part of error messages or warnings (instead of <code>authority-0</code>, <code>authority-1</code> and so on.)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The attestations array - if included, each attestation must be present for the <code>authority</code> to approve the image</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apply these changes (names) and additions (attestation check for the <code>key</code> authority) to our <code>simple-cluster-image-policy</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that change, we&#8217;ll check if our keylessly signed image will still be admitted (it should) and our "keyfully" signed image, but without the attestation works (it shouldn&#8217;t):</p>
</div>
<div class="paragraph">
<p><strong>Keyless</strong> âœ…</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keyless
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, this works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-keylessly:2025-11-17_14-44
deployment.apps/signed-image-keyless configured <i class="conum" data-value="1"></i><b>(1)</b>
service/signed-image-keyless unchanged
route.route.openshift.io/signed-image-keyless unchanged</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Webhooks have been applied</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>With Key but without attestation</strong> âŒ</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now - it is complaining about the missing attestation, as it should: <code>no matching attestations</code> - and also <code>no matching signatures</code> (of the attestation). âŒ</p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged
Error from server (BadRequest): error when applying patch:
{"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"signed-image-key"}],"containers":[{"image":"quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43","name":"signed-image-key"}]}}}}
to:
Resource: "apps/v1, Resource=deployments", GroupVersionKind: "apps/v1, Kind=Deployment"
Name: "signed-image-key", Namespace: "student-admission-test"
for: "STDIN": error when patching "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824 attestation key validation failed for authority key-with-attestation-check for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824: no matching attestations:  signature keyless validation failed for authority keyless-no-attestation for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824: no matching signatures: error verifying bundle: nil certificate provided</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_adding_an_attestation"><a class="anchor" href="#_adding_an_attestation"></a>Adding an attestation</h3>
<div class="paragraph">
<p>Similar to our previous exercise <a href="ex2-enterprise-contract.html#_building_a_custom_attestation" class="xref page">Building a custom attestation</a> we&#8217;ll add our own attestation to the "keyfully" signed image.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You could also use an image that was signed and attested by <strong>Tekton Chains</strong>. In that case, you&#8217;d have to use the <code>https://slsa.dev/provenance/v0.2</code> predicateType.<br>
You could also attest that keylessly - then you&#8217;d add that to the <code>keyless-no-attestation</code> authority for verification (and probably change its name ðŸ˜‰)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We&#8217;ll use the same attestation:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore
cat &gt; release-approval-predicate.json &lt;&lt;'EOF'
{
  "release": {
    "approved": true,
    "approvalDate": "2025-11-08T12:00:00Z",
    "approver": "Jane Smith",
    "approverEmail": "jane.smith@example.com"
  },
  "serviceNowTickets": [
    {
      "ticketId": "CHG0012345",
      "url": "https://servicenow.example.com/nav_to.do?uri=change_request.do?sys_id=abc123",
      "type": "Change Request",
      "status": "Approved",
      "approvalDate": "2025-11-07T15:30:00Z"
    },
    {
      "ticketId": "RITM0067890",
      "url": "https://servicenow.example.com/nav_to.do?uri=sc_req_item.do?sys_id=def456",
      "type": "Requested Item",
      "status": "Closed Complete",
      "completionDate": "2025-11-08T09:00:00Z"
    }
  ],
  "metadata": {
    "processVersion": "1.0",
    "complianceFramework": "ADS-Scholars Release Policy",
    "notes": "Standard release approval process completed"
  }
}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>and we&#8217;ll attest it with the public/private key pair stored in the <code>openshift-pipelines</code> namespace - the same that we also used to sign the image.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">source prep/signed-image-keys/image.env
cosign attest \
  --key k8s://openshift-pipelines/signing-secrets \
  --type https://redhat.com/ads-scholars/v1 \
  --predicate release-approval-predicate.json \
  $IMAGE</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you restarted the terminal pod between exercises, you might have lost the cached <code>cosign</code> login data to Quay and you will get an error message when <code>cosign</code> tries to push the attestation.<br>
In that case, just run <code>./cosign-login.sh</code> from that same directory.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore
./cosign-login.sh</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we now try to deploy it again, it will pass, since it has at least one signed attestation of the required type <code>https://redhat.com/ads-scholars/v1</code></p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
deployment.apps/signed-image-key configured
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now it passed âœ…ðŸ‘</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_rego_policy"><a class="anchor" href="#_adding_a_rego_policy"></a>Adding a <code>rego</code> policy</h3>
<div class="paragraph">
<p>So far, we have successfully verified that all images deployed to our <code>student-admission-test</code> are either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(keylessly) signed by a Red Hatter that was authenticated by any OIDC System ending with <code>redhatworkshops.io</code><br>
or<br></p>
</li>
<li>
<p>signed with a <code>cosign</code> key <strong>AND</strong> has a signed attestation of type <code>https://redhat.com/ads-scholars/v1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Beyond checking for the existence of the attestation, we haven&#8217;t done anything with it. However, we can also apply a policy to the attestation (validate the attestation content).</p>
</div>
<div class="paragraph">
<p>We can extend the <code>attestation</code> in our ClusterImagePolicy with a policy that applies to attestation. (Yes, yes, yes - agreed. A <em>policy</em> inside a <em>policy</em> is a bit&#8230;&#8203;cumbersome?)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
    - name: key-with-attestation-check
      key:
        secretRef:
          name: secretName
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy: <i class="conum" data-value="1"></i><b>(1)</b>
          type: rego <i class="conum" data-value="2"></i><b>(2)</b>
          data: | <i class="conum" data-value="3"></i><b>(3)</b>
            package sigstore
            default isCompliant = false
            isCompliant {
              input.predicate.release.approved == true
            }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>For this attestation, we define an additional policy</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use <code>rego</code> as language. Available options are <code>rego</code> or <code>cue</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Here, we define an inline <code>rego</code> policy</td>
</tr>
</table>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          data: |
            package sigstore
            default isCompliant = false
            isCompliant {
              input.predicate.release.approved == true
            }
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can try to deploy our image again - given that the attestation contains this section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">"release": {
    "approved": true,
    "approvalDate": "2025-11-08T12:00:00Z",
    "approver": "Jane Smith",
    "approverEmail": "jane.smith@example.com"
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can expect this to pass.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;which it does:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
deployment.apps/signed-image-key configured
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can modify our policy to validate a predicate field to force a fail (for sake of completeness):</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          data: |
            package sigstore
            default isCompliant = false
            isCompliant {
              input.predicate.release.approved == true
              input.predicate.release.approverEmail == "jane.doe@example.com"
            }
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>Checking with our image and attestation:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, it fails now: <code>failed evaluating rego policy for type check-approval</code></p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Error from server (BadRequest): error when applying patch:
{"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"signed-image-key"}],"containers":[{"image":"quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43","name":"signed-image-key"}]}}}}
to:
Resource: "apps/v1, Resource=deployments", GroupVersionKind: "apps/v1, Kind=Deployment"
Name: "signed-image-key", Namespace: "student-admission-test"
for: "STDIN": error when patching "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824 failed evaluating rego policy for type check-approval: policy is not compliant for query 'isCompliant = data.sigstore.isCompliant' signature keyless validation failed for authority keyless-no-attestation for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824: no matching signatures: error verifying bundle: nil certificate provided</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you look closely, it will also tell you that <code>validation failed for authority keyless-no-attestation</code> - because it also tried this authority, since the other failed with with the <code>rego</code> policy validation error.<br>
Remember, for <code>authorities</code> it&#8217;s an <strong>OR</strong>, so if one succeeds, it will pass. So, it will try all - but in this case all fail.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_complex_rego_policies"><a class="anchor" href="#_complex_rego_policies"></a>Complex <code>rego</code> policies</h3>
<div class="paragraph">
<p>Let&#8217;s say (given our comparatively simple attestation) we&#8217;d like to have a more complex validation logic:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Does the attestation contain at least one ServiceNow Ticket?</p>
</li>
<li>
<p>For all ServiceNow Tickets:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If the ticket is a "Change Request" the status has to be "Approved"</p>
</li>
<li>
<p>If the ticket is a "Requested Item" the status has to be "Closed Complete"</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>we can encapsulate this <em>inline</em> as shown below - so please apply this slightly more complex <code>ClusterImagePolicy</code>:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          data: |
                package sigstore

                default isCompliant = false

                isCompliant {
                  # Check that release is approved
                  input.predicate.release.approved == true

                  # Check that serviceNowTickets array exists and has at least one entry
                  count(input.predicate.serviceNowTickets) &gt; 0

                  # Check that all tickets have valid status for their type
                  not any_invalid_ticket_status
                }

                # Helper rule: checks if ANY ticket has an invalid status
                any_invalid_ticket_status {
                  ticket := input.predicate.serviceNowTickets[_]
                  not valid_ticket_status(ticket)
                }

                # Helper rule: validates ticket status based on type
                valid_ticket_status(ticket) {
                  ticket.type == "Change Request"
                  ticket.status == "Approved"
                }

                valid_ticket_status(ticket) {
                  ticket.type == "Requested Item"
                  ticket.status == "Closed Complete"
                }
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and we also want to check if it is working (again, with our image &amp; attestation):</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a negative test (validation failed) for sake of completeness, open the section below, apply the policy and test:</p>
</div>
<div class="paragraph">
<p><strong>Click &amp; Expand</strong></p>
</div>
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="paragraph">
<p>The rego policy in this CIP will check for the status value "Closed" in the "Requested Item" ServiceNow Ticket attestation field. We know that it is (and has to be) "Closed Completed", so testing with the given attestation should fail.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          data: |
                package sigstore

                default isCompliant = false

                isCompliant {
                  # Check that release is approved
                  input.predicate.release.approved == true

                  # Check that serviceNowTickets array exists and has at least one entry
                  count(input.predicate.serviceNowTickets) &gt; 0

                  # Check that all tickets have valid status for their type
                  not any_invalid_ticket_status
                }

                # Helper rule: checks if ANY ticket has an invalid status
                any_invalid_ticket_status {
                  ticket := input.predicate.serviceNowTickets[_]
                  not valid_ticket_status(ticket)
                }

                # Helper rule: validates ticket status based on type
                valid_ticket_status(ticket) {
                  ticket.type == "Change Request"
                  ticket.status == "Approved"
                }

                valid_ticket_status(ticket) {
                  ticket.type == "Requested Item"
                  ticket.status == "Closed"
                }
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the test:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, it fails with <code>evaluating rego policy for type check-approval: policy is not compliant</code></p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Error from server (BadRequest): error when applying patch:
{"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"signed-image-key"}],"containers":[{"image":"quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43","name":"signed-image-key"}]}}}}
to:
Resource: "apps/v1, Resource=deployments", GroupVersionKind: "apps/v1, Kind=Deployment"
Name: "signed-image-key", Namespace: "student-admission-test"
for: "STDIN": error when patching "STDIN": admission webhook "policy.rhtas.com" denied the request: validation failed: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824 signature keyless validation failed for authority keyless-no-attestation for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key@sha256:358b575f24615d8bfc096dae0d43649086b1b6235ecbae9f3c911bfc686c1824: no matching signatures: error verifying bundle: nil certificate provided failed evaluating rego policy for type check-approval: policy is not compliant for query 'isCompliant = data.sigstore.isCompliant'</code></pre>
</div>
</div>
<hr>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_externalising_rego_policies"><a class="anchor" href="#_externalising_rego_policies"></a>Externalising rego policies</h3>
<div class="paragraph">
<p>For more complex <code>rego</code> policies, having those <em>inline</em> with the <code>ClusterImagePolicy</code> has two important drawbacks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Management: Managing and testing more complex rego policies as inline rego code can become cumbersome</p>
</li>
<li>
<p>Coupling: If inline, you cannot manage or update them independently, also making re-use of the rego logic in more than one CIP impossible</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_using_configmaps"><a class="anchor" href="#_using_configmaps"></a><strong>Using ConfigMaps</strong></h4>
<div class="paragraph">
<p>We can externalise our <code>rego</code> logic by moving it to a <code>configMap</code> and then reference it from the <code>ClusterImagePolicy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          configMapRef:
            name: policy-config
            key: approval-policy</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make that work, we need to create a <code>configMap</code> with our policy in the <code>policy-controller-operator</code> namespace:</p>
</div>
<div class="paragraph">
<p>We already have our above rego policy as a file <code>approval-policy.rego</code> in our helpers repository:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore
cat approval-policy.rego</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, we can create a <code>configMap</code> like this:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore
oc create configmap policy-config --from-file=approval-policy=approval-policy.rego \
-n policy-controller-operator
oc describe configmap policy-config -n policy-controller-operator</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, apply our <code>ClusterImagePolicy</code> with the externalised <code>rego</code> policy:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          configMapRef:
            name: policy-config
            key: approval-policy
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>and test if our validation still works:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>It does, as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
deployment.apps/signed-image-key configured
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_urls"><a class="anchor" href="#_using_urls"></a><strong>Using URLs</strong></h4>
<div class="paragraph">
<p>Another option to externalise rego policies is by providing a <code>https</code> URL to fetch the <code>rego</code> policy from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          remote:
            url: "https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tas-tssc/controllers/sigstore/approval-policy.rego"
            sha256sum: 5a5917ccad0eddf7d60375e5612d2913164828f8ac4be8ffbd7dc0d8e5fa5934</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For <code>remote</code> locations, the policy controller requires a sha256 fingerprint in the configuration to make sure that the policy is exactly what you expect it to be.</p>
</div>
<div class="paragraph">
<p>To get the fingerprint, use <code>curl</code> with a piped <code>sha256sum</code> for example</p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -sL https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tas-tssc/controllers/sigstore/approval-policy.rego | sha256sum
5a5917ccad0eddf7d60375e5612d2913164828f8ac4be8ffbd7dc0d8e5fa5934  -</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s try this one:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          remote:
            url: "https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tas-tssc/controllers/sigstore/approval-policy.rego"
            sha256sum: 5a5917ccad0eddf7d60375e5612d2913164828f8ac4be8ffbd7dc0d8e5fa5934

EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and test it again:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/signed-image-keys
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-signed-key:2025-11-17_14-43
deployment.apps/signed-image-key configured
service/signed-image-key unchanged
route.route.openshift.io/signed-image-key unchanged</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tips_tricks"><a class="anchor" href="#_tips_tricks"></a>Tips &amp; Tricks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_testing_policies_with_warn"><a class="anchor" href="#_testing_policies_with_warn"></a>Testing Policies with <code>warn</code></h3>
<div class="paragraph">
<p>To learn the impact of your policy before making it <code>live</code> across your cluster, you can configure the <code>mode</code> on the policy level. Allowed values are <code>enforce</code> (the default) or <code>warn</code> - which will admit the image, but issue a warning.</p>
</div>
<div class="paragraph">
<p>If we use that with our policy, we should be allowed to even deploy the unsigned image:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  mode: warn <i class="conum" data-value="1"></i><b>(1)</b>
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v1
        policy:
          type: rego
          remote:
            url: "https://raw.githubusercontent.com/redhat-tssc-tmm/l3-enablement-helpers/refs/heads/main/tas-tssc/controllers/sigstore/approval-policy.rego"
            sha256sum: 5a5917ccad0eddf7d60375e5612d2913164828f8ac4be8ffbd7dc0d8e5fa5934

EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>on the policy <code>spec</code> level, specify the "enforcement mode"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, let&#8217;s try to deploy our <strong>unsigned</strong> image:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/prep/unsigned-image
source image.env
echo ""
echo "IMAGE: ${IMAGE}"
sed "s|\$IMAGE|$IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected, our image (deployment) passes now, but with warnings:</p>
</div>
<div class="listingblock wrap">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned:2025-11-17_14-41
Warning: failed policy: simple-cluster-image-policy: spec.template.spec.containers[0].image
Warning: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned:2025-11-17_14-41@sha256:c3804ea119c09bdbc9d5e15321b3d63393829523dc9061f05ee0d6906fb2806d signature keyless validation failed for authority keyless-no-attestation for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned@sha256:c3804ea119c09bdbc9d5e15321b3d63393829523dc9061f05ee0d6906fb2806d: no signatures found attestation key validation failed for authority key-with-attestation-check for quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/l3-students/l3-rhads-unsigned@sha256:c3804ea119c09bdbc9d5e15321b3d63393829523dc9061f05ee0d6906fb2806d: no matching attestations:
deployment.apps/unsigned-image created <i class="conum" data-value="1"></i><b>(1)</b>
service/unsigned-image unchanged
route.route.openshift.io/unsigned-image unchanged</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This time the deployment has been created, despite the failing policy</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_fine_tuning_policies_with_labels_and_resourcetypes"><a class="anchor" href="#_fine_tuning_policies_with_labels_and_resourcetypes"></a>Fine-tuning Policies with Labels and ResourceTypes</h3>
<div class="paragraph">
<p>If a policy is too coarse for your needs (remember, every namespace labelled <code>policy.rhtas.com/include=true</code> will be subject to all policies) - you can fine-tune it:</p>
</div>
<div class="paragraph">
<p>As mentioned earlier, by default all Resources that use a direct or implicit <code>PodSpec</code> field will be enforced - that&#8217;s why our deployment was blocked.</p>
</div>
<div class="paragraph">
<p>You can tailor this behaviour to specific resource types by adding the <code>match</code> field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  match: <i class="conum" data-value="1"></i><b>(1)</b>
  - resource: jobs
    group: batch
    version: v1
  - resource: pods
    version: v1
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This policy would only be enforced on jobs and pods</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This can be tuned even more by specifying labels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  match: <i class="conum" data-value="1"></i><b>(1)</b>
  - resource: cronjobs
    group: batch
    version: v1
    selector:
      matchLabels: <i class="conum" data-value="2"></i><b>(2)</b>
        prod: x-cluster1
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This policy would only be enforced on cronjobs</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203;but only those with the label <code>prod=x-cluster1</code></td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This feature only supports the selection of the following resource types: <code>pods</code>, <code>statefulsets</code>, <code>daemonsets</code>, <code>cronjobs</code>, <code>jobs</code>, <code>deployments</code> and <code>replicasets</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_combining_conforma_and_clusterimagepolicies"><a class="anchor" href="#_combining_conforma_and_clusterimagepolicies"></a>Combining Conforma and ClusterImagePolicies</h3>
<div class="paragraph">
<p>If you are using complex Conforma (Enterprise Contract) policies, for example evaluating SLSA compliance, you don&#8217;t have to rebuild that logic (and the policies) for use by the Sigstore Policy Controller.</p>
</div>
<div class="paragraph">
<p>A valid case is to run the <code>ec validate image</code> with complex SLSA compliance checks (or whatever you want <code>ec</code> to validate) and then <strong>attest the ec results</strong>.</p>
</div>
<div class="paragraph">
<p>In that case, your <code>rego</code> logic in the <code>ClusterImagePolicy</code> would just have to verify your custom attestation with the <code>ec</code> results - and if your image couldn&#8217;t be validated in <code>ec</code> or has gaps in the <code>ec</code> results, it wouldn&#8217;t be admitted.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/tssc-tas/greatidea.gif" alt="greatidea" width="200">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For this example, we&#8217;ll re-use the image from our <a href="ex1-chains.html" class="xref page">Tekton Chains Exercise</a>, so please check if you have an image in {quay_url}/repository/tssc/tekton-chains-test?tab=tags[Quay here^, window="quay"].<br>
To login to Quay, use <code>{quay_admin_user}</code> and <code>{quay_admin_password}</code></p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="../_images/tssc-tas/rhdh-tekton-chains-test-quay.png" target="image"><img src="../_images/tssc-tas/rhdh-tekton-chains-test-quay.png" alt="rhdh tekton chains test quay"></a>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t, you&#8217;ll have to go through that exercise to create an image that has been attested by <strong>Tekton Chains</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We will now combine a few things from the previous chapters:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The image with the Chains attestation of type <code>https://slsa.dev/provenance/v0.2</code></p>
</li>
<li>
<p><code>ec</code> (Enterprise Contract or <em>execute conforma</em>) validating SLSA compliance</p>
</li>
<li>
<p>We will capture the <code>ec</code> result and wrap that in a custom predicate</p>
</li>
<li>
<p>We will attest that predicate</p>
</li>
<li>
<p>We will then change our ClusterImagePolicy to validate this custom attestation</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>This last step effectively offloads the complex SLSA validation to <code>ec</code> and its numerous SLSA policies.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We&#8217;re doing this in our terminal, but naturally this should happen as part of the release pipeline.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>First, let&#8217;s get the <code>$CHAINS_IMAGE</code> variable again, pointing to the most recent tag that we (our Tekton Pipeline, with Chains enabled) has pushed:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/slsa-example
source ./get-chains-image-sha.sh <i class="conum" data-value="1"></i><b>(1)</b>
echo "Now validating SLSA compliance"
ec validate image \
--image $CHAINS_IMAGE \
--public-key k8s://openshift-pipelines/signing-secrets \
--rekor-url $SIGSTORE_REKOR_URL \
--policy '{
  "sources": [{
    "policy": ["oci::quay.io/enterprise-contract/ec-release-policy:latest"],
    "data": ["git::https://github.com/enterprise-contract/ec-policies//example/data"],
    "config": {
      "include": [
        "@slsa3"
      ],
      "exclude": [
        "slsa_source_correlated.source_code_reference_provided"
      ]
    }
  }]
}' --info --show-successes --output json | jq &gt; ec-validation-predicate.json <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we need to source it, so the <code>$CHAINS_IMAGE</code> variable is available for subsequent steps</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we&#8217;ll store the full result as json</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want, take look at the result:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">less ec-validation-predicate.json</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>HINT:</strong> Exit <code>less</code> with <kbd>q</kbd> or <kbd>Q</kbd></p>
</div>
<div class="paragraph">
<p>We will attest this now as our custom predicateType <code>https://redhat.com/ads-scholars/v2/ec-validation</code>, using the same key that <strong>Tekton Chains</strong> used to create its SLSA attestations:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cosign attest \
  --key k8s://openshift-pipelines/signing-secrets \
  --type https://redhat.com/ads-scholars/v2/ec-validation \
  --predicate ec-validation-predicate.json \
  $CHAINS_IMAGE</code></pre>
</div>
</div>
<div class="paragraph">
<p>For sake of completeness, we quickly verify the attestation:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cosign verify-attestation \
--type https://redhat.com/ads-scholars/v2/ec-validation \
--key k8s://openshift-pipelines/signing-secrets \
$CHAINS_IMAGE |  jq -r '.payload' | base64 -d | jq .</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now, we&#8217;ll update our policy to validate our new custom attestation for all images (glob: "**") that have been signed with the cosign key that Tekton Chains uses:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project policy-controller-operator
echo ""
echo "SIGSTORE_FULCIO_URL: ${SIGSTORE_FULCIO_URL}"
echo "SIGSTORE_REKOR_URL:  ${SIGSTORE_REKOR_URL}"
echo ""

cat &lt;&lt;EOF | oc apply -f -
apiVersion: policy.sigstore.dev/v1beta1
kind: ClusterImagePolicy
metadata:
  name: simple-cluster-image-policy
spec:
  images:
    - glob: "**"
  authorities:
    - name: keyless-no-attestation
      keyless:
        url: $SIGSTORE_FULCIO_URL
        trustRootRef: trust-root
        identities:
          - issuerRegExp: '\.redhatworkshops\.io/'
            subjectRegExp: '.*@.*redhat\.com$'
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
    - name: key-with-attestation-check
      key:
        secretRef:
          name: chains-cosign-pubkey
      ctlog:
        url: $SIGSTORE_REKOR_URL
        trustRootRef: trust-root
      attestations:
      - name: check-approval
        predicateType: https://redhat.com/ads-scholars/v2/ec-validation
        policy:
          type: rego
          data: |
                package sigstore

                default isCompliant = false

                isCompliant {
                  # Check that ec run attested was a success
                  input.predicate.success == true

                  # Check that @slsa3 rule set was included in the policy
                  slsa3_included

                  # Check that there are no warnings in any component
                  no_warnings
                }

                # Helper: Check if @slsa3 is in the included rule sets
                slsa3_included {
                  input.predicate.policy.sources[_].config.include[_] == "@slsa3"
                }

                # Helper: Check that no component has warnings
                no_warnings {
                  not any_component_has_warnings
                }

                # Helper: Check if any component has warnings
                any_component_has_warnings {
                  component := input.predicate.components[_]
                  count(component.warnings) &gt; 0
                }
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This <code>rego</code> policy could also have been externalised as previously shown, but we kept it <em>inline</em> for readability here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And now, let&#8217;s try to deploy the attested image:</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project student-admission-test
cd /workspace/l3-enablement-helpers/tas-tssc/controllers/sigstore/slsa-example
echo ""
echo "IMAGE: ${CHAINS_IMAGE}"
sed "s|\$IMAGE|$CHAINS_IMAGE|g" deploy.yaml | oc apply -f -</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">IMAGE: quay-vtm4r.apps.cluster-vtm4r.dynamic.redhatworkshops.io/tssc/tekton-chains-test@sha256:e12b7912703a8b07949b21a2fe4eb0603777d827f3d43c6082d6f71700a5334e
deployment.apps/slsa-verified-signed-image created
service/slsa-verified-signed-image unchanged
route.route.openshift.io/slsa-verified-signed-image unchanged</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_what_gets_validated"><a class="anchor" href="#_what_gets_validated"></a><strong>What Gets Validated</strong></h4>
<div class="paragraph">
<p>Based on the attestation structure, which is basically the <code>ec</code> result, this policy ensures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>âœ… Overall EC validation succeeded (predicate.success == true)</p>
</li>
<li>
<p>âœ… At least one <code>ec</code> policy source used the @slsa3 collection</p>
</li>
<li>
<p>âœ… No component reported any warnings</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="ex3.3-sigstore-config.html" class="query-params-link">Configuration</a></span>
  <span class="next"><a href="ex4-acs-controller.html" class="query-params-link">RHACS Admission Controller</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>  </div>
</main>
</div>
<footer class="footer">
  <a href="https://demo.redhat.com" target="_blank" class="poweredBy"><p>Powered by</p><div class="labInfo_poweredBy" style="display: block; width: 260px;"><svg class="labInfo_poweredByLogo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1508.5 178.739"><g fill="#111"><path d="M316.6 63.2v-56H342a21.279 21.279 0 0 1 7.8 1.3 18.111 18.111 0 0 1 5.9 3.5 15.577 15.577 0 0 1 5 11.8 15.051 15.051 0 0 1-3.1 9.5 16.836 16.836 0 0 1-8.4 5.8l12.5 24.1h-9.3l-11.6-23H325v23Zm24.7-48.6H325v18.7h16.3q5.25 0 8.1-2.7a8.7 8.7 0 0 0 2.8-6.6 8.7 8.7 0 0 0-2.8-6.6c-1.8-1.9-4.5-2.8-8.1-2.8ZM364.1 42.8a20.674 20.674 0 0 1 1.6-8.2 20.288 20.288 0 0 1 4.3-6.7 19.92 19.92 0 0 1 6.5-4.5 19.718 19.718 0 0 1 8-1.6 18.463 18.463 0 0 1 7.8 1.6 18.677 18.677 0 0 1 6.2 4.5 20.927 20.927 0 0 1 4.1 6.8 23.2 23.2 0 0 1 1.5 8.4v2.3H372a13.822 13.822 0 0 0 4.6 8.4 13.6 13.6 0 0 0 9.1 3.3 15.553 15.553 0 0 0 5.7-1 12.858 12.858 0 0 0 4.6-2.6l5.1 5a25.983 25.983 0 0 1-7.4 4.1 24.69 24.69 0 0 1-8.4 1.3 21.306 21.306 0 0 1-8.4-1.6 22.763 22.763 0 0 1-6.8-4.4 20.788 20.788 0 0 1-4.5-6.7 23.2 23.2 0 0 1-1.5-8.4Zm20.2-14.2a11.527 11.527 0 0 0-8 3 13.046 13.046 0 0 0-4.2 7.8h24.2a13.091 13.091 0 0 0-4.2-7.8 11.106 11.106 0 0 0-7.8-3ZM443.1 63.2v-3.8a19.448 19.448 0 0 1-5.8 3.3 18.924 18.924 0 0 1-6.7 1.2 19.824 19.824 0 0 1-14.6-6.1 22.268 22.268 0 0 1-4.4-6.7 21.812 21.812 0 0 1 0-16.4A20.534 20.534 0 0 1 416 28a19.335 19.335 0 0 1 6.6-4.5 20.334 20.334 0 0 1 8.2-1.6 20.7 20.7 0 0 1 6.6 1 19.415 19.415 0 0 1 5.7 3V7.2l8-1.8v57.8Zm-25.2-20.4a13.718 13.718 0 0 0 4 10.1 13.45 13.45 0 0 0 9.8 4.1 14.956 14.956 0 0 0 6.4-1.3 15.954 15.954 0 0 0 4.9-3.6V33.6a14.988 14.988 0 0 0-4.9-3.5 15.271 15.271 0 0 0-6.4-1.3 13.423 13.423 0 0 0-9.9 4 13.806 13.806 0 0 0-3.9 10ZM478.1 63.2v-56h8.4v24h29.8v-24h8.4v56h-8.4V38.8h-29.8v24.4ZM547.2 64a16.483 16.483 0 0 1-10.8-3.5 11.037 11.037 0 0 1-4.2-8.9 10.375 10.375 0 0 1 4.7-9.2 20.76 20.76 0 0 1 11.8-3.2 27.841 27.841 0 0 1 5.8.6 27.374 27.374 0 0 1 5.3 1.6v-4.3a8.143 8.143 0 0 0-2.6-6.5 11.452 11.452 0 0 0-7.4-2.2 20.788 20.788 0 0 0-6 .9 34.616 34.616 0 0 0-6.6 2.6l-3-6a54.169 54.169 0 0 1 8.4-3.1 33.18 33.18 0 0 1 8.3-1.1c5.2 0 9.3 1.3 12.2 3.8s4.4 6.1 4.4 10.8v27h-7.8v-3.5a19.441 19.441 0 0 1-5.8 3.2 23.54 23.54 0 0 1-6.7 1Zm-7.3-12.6a5.646 5.646 0 0 0 2.6 4.8 11.193 11.193 0 0 0 6.6 1.8 16.256 16.256 0 0 0 5.9-1 14.449 14.449 0 0 0 4.9-2.9V47a19.778 19.778 0 0 0-4.8-1.8 24.933 24.933 0 0 0-5.7-.6 11.859 11.859 0 0 0-6.8 1.8 5.728 5.728 0 0 0-2.7 5ZM580.6 53.2v-24H572v-6.7h8.6V12.1l7.9-1.9v12.3h12v6.7h-12v22.1a5.94 5.94 0 0 0 1.4 4.4c.9.9 2.5 1.3 4.6 1.3a23.637 23.637 0 0 0 3-.2 10.857 10.857 0 0 0 2.8-.8v6.7a19.28 19.28 0 0 1-3.8.9 27.484 27.484 0 0 1-3.8.3c-3.9 0-7-.9-9-2.8-2-1.7-3.1-4.4-3.1-7.9Z"></path></g><path d="M127 90.2c12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4L149.8 37c-1.7-7.1-3.2-10.3-15.7-16.6-9.7-5-30.8-13.1-37.1-13.1-5.8 0-7.5 7.5-14.4 7.5-6.7 0-11.6-5.6-17.9-5.6-6 0-9.9 4.1-12.9 12.5 0 0-8.4 23.7-9.5 27.2a4.216 4.216 0 0 0-.3 1.9c0 9.2 36.3 39.4 85 39.4Zm32.5-11.4c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3C21.8 58.8 0 61.8 0 81c0 31.5 74.6 70.3 133.7 70.3 45.3 0 56.7-20.5 56.7-36.6-.1-12.8-11-27.3-30.9-35.9Z" fill="#e00"></path><path d="M159.5 78.8c1.7 8.2 1.7 9.1 1.7 10.1 0 14-15.7 21.8-36.4 21.8-46.8 0-87.7-27.4-87.7-45.5a17.535 17.535 0 0 1 1.5-7.3l3.7-9.1a4.877 4.877 0 0 0-.3 2c0 9.2 36.3 39.4 85 39.4 12.5 0 30.6-2.6 30.6-17.5a12.678 12.678 0 0 0-.3-3.4Z"></path><path d="M253.5 158.7a2.22 2.22 0 0 1-2.2-2.2V2.2a2.2 2.2 0 0 1 4.4 0v154.2a2.242 2.242 0 0 1-2.2 2.3Z" fill="#111"></path><text data-name="Demo Platform" transform="translate(1186 149)" fill="#111" font-size="82" font-family="'RedHatDisplay', 'Overpass', overpass, helvetica, arial, sans-serif" font-weight="700"><tspan x="-877.892" y="0">Demo Platform</tspan></text></svg></div></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
